<!DOCTYPE html><html lang='ru'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=550'>
<title>Home 181</title>

<style>
body {margin: 0; background: #cfd8dc; color: #455a64; font-family: Helvetica; font-size: 15px; }
::selection {background: #a0bbbb;}
::-moz-selection {background: #a0bbbb;}
input, textarea, button, select, select:focus {outline: none;}

.icoCH {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDI0Ni44ODkgMjQ2Ljg4OSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjQ2Ljg4OSAyNDYuODg5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjI0cHgiIGhlaWdodD0iMjRweCI+CjxwYXRoIGQ9Ik0yNy43NzcsMTk0LjA0NmgyMTkuMTExdjI3Ljc3N0gwVjI1LjA2NWgyNy43NzdWMTk0LjA0NnogTTEzNy4zMDgsMTQzLjIzM2w4My44MTEtNjMuNzlMMjA0LjI5Niw1Ny4zNGwtNjMuODUsNDguNTk3ICBsLTI0LjAyOC0yNS42NzFsLTY2LjkxMSw1Mi40MDZsMTcuMTI4LDIxLjg2OWw0Ni44ODYtMzYuNzIzTDEzNy4zMDgsMTQzLjIzM3oiIGZpbGw9IiM0NTVhNjQiLz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)}

.icoBack {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0OTIgNDkyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0OTIgNDkyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjI0cHgiIGhlaWdodD0iMjRweCI+CjxnPgoJPGc+CgkJPHBhdGggZD0iTTQ2NC4zNDQsMjA3LjQxOGwwLjc2OCwwLjE2OEgxMzUuODg4bDEwMy40OTYtMTAzLjcyNGM1LjA2OC01LjA2NCw3Ljg0OC0xMS45MjQsNy44NDgtMTkuMTI0ICAgIGMwLTcuMi0yLjc4LTE0LjAxMi03Ljg0OC0xOS4wODhMMjIzLjI4LDQ5LjUzOGMtNS4wNjQtNS4wNjQtMTEuODEyLTcuODY0LTE5LjAwOC03Ljg2NGMtNy4yLDAtMTMuOTUyLDIuNzgtMTkuMDE2LDcuODQ0ICAgIEw3Ljg0NCwyMjYuOTE0QzIuNzYsMjMxLjk5OC0wLjAyLDIzOC43NywwLDI0NS45NzRjLTAuMDIsNy4yNDQsMi43NiwxNC4wMiw3Ljg0NCwxOS4wOTZsMTc3LjQxMiwxNzcuNDEyICAgIGM1LjA2NCw1LjA2LDExLjgxMiw3Ljg0NCwxOS4wMTYsNy44NDRjNy4xOTYsMCwxMy45NDQtMi43ODgsMTkuMDA4LTcuODQ0bDE2LjEwNC0xNi4xMTJjNS4wNjgtNS4wNTYsNy44NDgtMTEuODA4LDcuODQ4LTE5LjAwOCAgICBjMC03LjE5Ni0yLjc4LTEzLjU5Mi03Ljg0OC0xOC42NTJMMTM0LjcyLDI4NC40MDZoMzI5Ljk5MmMxNC44MjgsMCwyNy4yODgtMTIuNzgsMjcuMjg4LTI3LjZ2LTIyLjc4OCAgICBDNDkyLDIxOS4xOTgsNDc5LjE3MiwyMDcuNDE4LDQ2NC4zNDQsMjA3LjQxOHoiIGZpbGw9IiM0NTVhNjQiLz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)}

.icoUpdate {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTcuMS4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDMxNy44NzggMzE3Ljg3OCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzE3Ljg3OCAzMTcuODc4OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjI0cHgiIGhlaWdodD0iMjRweCI+CjxwYXRoIGQ9Ik0zMTUuNjA3LDcwLjIzN2MtMi42NTMtMy4wODYtNy4xODktMy44ODEtMTEuNzI5LTEuOTI4bC0zOC4wNDIsMTYuMzY5QzI0MC42NzQsNDMuMzE0LDE5NS4xNjMsMTUuNjMsMTQzLjMwOSwxNS42MyAgQzY0LjI4OCwxNS42MywwLDc5LjkxOCwwLDE1OC45MzlzNjQuMjg4LDE0My4zMDksMTQzLjMwOSwxNDMuMzA5YzExLjA0NiwwLDIwLTguOTU0LDIwLTIwcy04Ljk1NC0yMC0yMC0yMCAgQzg2LjM0NCwyNjIuMjQ3LDQwLDIxNS45MDMsNDAsMTU4LjkzOVM4Ni4zNDQsNTUuNjMsMTQzLjMwOSw1NS42M2MzNS4zNzksMCw2Ni42NTcsMTcuODgsODUuMjg0LDQ1LjA3NGwtMzYuMjcxLDE1LjYwNyAgYy0zLjg4NSwxLjY3Mi02LjMxNCw0LjYyOS02LjY2Niw4LjExM2MtMC4zNTEsMy40ODMsMS40NCw2Ljg2Niw0LjkxMyw5LjI3OWw5My41MDMsNjQuOTc5YzIuMTI5LDEuNDc5LDQuNDQ4LDIuMjYyLDYuNzA2LDIuMjYyICBjMC4wMDEsMCwwLjAwMSwwLDAuMDAxLDBjNS4wMjgsMCw4Ljk4LTMuNzcsOS44MzItOS4zNzlsMTcuMTAzLTExMi41NzJDMzE4LjIzOSw3NS41MzgsMzE3LjQ5MSw3Mi40MjksMzE1LjYwNyw3MC4yMzd6IiBmaWxsPSIjNDU1YTY0Ii8+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=)}

.icoCH, .icoBack, .icoUpdate {width: 24px; height: 24px; margin: 12px 0 0 0;}

.ram1{float:right; width: 48px; height: 48px; margin: -12px 12px 0 0; 
    background: #f7f7f7; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6); 
    -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;}
.ram1:active {box-shadow: 0 2px 4px rgba(0, 0, 0, 0.0);}

.ram2 { float: left; width: 48px; height: 48px; margin: 10px 12px 0 0; 
    background: #f7f7f7; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6); 
    -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;}
.ram2:active {box-shadow: 0 2px 4px rgba(0, 0, 0, 0.0);}

a {color: #455a64}
h1 {font-size: 18px; font-weight:normal; margin: 0 0 12px 0;}

#id_ram0 {width: 550px; margin:12px 0 0 0;}
.lab1 {width: 50%;}
.lab2 {width: 100%;}
.lab3 {width: 100%; margin: 0 0 26px 0;}
.lab1, .lab2 {float: left;  margin: 0 0 12px 0;}
#id_modT1, #id_modT2, #id_modH, #id_modV, #id_modBMP, #id_modP
  {display: table; width: 234px; height: 234px; margin: 18px 0 8px 0; background: #f7f7f7;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6); -webkit-border-radius: 117px; 
    -moz-border-radius: 117px; border-radius: 117px;}

#chart_T1, #chart_T2, #chart_H, #chart_V, #chart_BMP, #chart_P {display: none;}

.inn {display: table-cell; vertical-align: middle; text-align: center;}

.ed {margin:10px 0px 12px 0; height: 48px; background: #fdfdfe; color: #455a64; font-family: Helvetica; 
    font-size: 18px; border: 1px solid gray; border-radius: 4px; padding: 6px; 
    box-shadow: 0 3px 4px rgba(0,0,0,0.1) inset;}

.b0 {float: left; font-size: 18px; margin: 0 8px 0 0;}
.b1 {float: right; font-size: 18px; padding: 4px 0 0 10px; margin: 14px 0 10px 0;}

#id_Interval, #id_Load { float: right;}

@-webkit-keyframes loader { 100% {-webkit-transform: rotate(360deg); transform: rotate(360deg);}}
@-moz-keyframes loader { 100% {-moz-transform: rotate(360deg); transform: rotate(360deg);}}
@keyframes loader { 100% { transform: rotate(360deg);}}

.loader {margin: 12px 0 12px 0; float: left; width: 24px; height: 24px; border: 4px solid #000; 
    border-left-color: #333; border-bottom-color: #555; border-right-color: transparent; border-radius: 100%; 
    -webkit-animation: loader 0.5s infinite linear; 
    -moz-animation: loader 0.5s infinite linear; 
    animation: loader 0.5s infinite linear;}

@-webkit-keyframes scalePlus{ 
from {opacity: 0;  -webkit-transform: scale(0); } to {opacity: 1; -webkit-transform: scale(1); }}
@-moz-keyframes scalePlus { 
from {opacity: 0;  -moz-transform: scale(0); } to {opacity: 1; -moz-transform: scale(1); }}
@-ms-keyframes scalePlus { 
from {opacity: 0;  -ms-transform: scale(0); } to {opacity: 1; -ms-transform: scale(1); }}
@-o-keyframes scalePlus {
from {opacity: 0;  -o-transform: scale(0); } to {opacity: 1; -o-transform: scale(1); }}
@keyframes scalePlus {
from {opacity: 0;  transform: scale(0); } to {opacity: 1; transform: scale(1); }}

@-webkit-keyframes scaleMinus{ 
from {opacity: 1;  -webkit-transform: scale(1); } to {opacity: 0; -webkit-transform: scale(0); }}
@-moz-keyframes scaleMinus { 
from {opacity: 1;  -moz-transform: scale(1); } to {opacity: 0; -moz-transform: scale(0); }}
@-ms-keyframes scaleMinus { 
from {opacity: 1;  -ms-transform: scale(1); } to {opacity: 0; -ms-transform: scale(0); }}
@-o-keyframes scaleMinus {
from {opacity: 1;  -o-transform: scale(1); } to {opacity: 0; -o-transform: scale(0); }}
@keyframes scaleMinus {
from {opacity: 1;  transform: scale(1); } to {opacity: 0; transform: scale(0); }}

canvas {-moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;}
#id_ram_canvas { display: none; min-width: 550px; width: 82%; margin:12px 0 12px 0; padding: 10px 10px 10px 10px;
    background: #f7f7f7; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);  
}

.plus {
  -webkit-animation: scalePlus 300ms linear;
  -moz-animation: scalePlus 300ms linear;
  -ms-animation: scalePlus 300ms linear;
  -o-animation: scalePlus 300ms linear;
  animation: scalePlus 300ms linear;    
}
.minus {
  -webkit-animation: scaleMinus 300ms linear;
  -moz-animation: scaleMinus 300ms linear;
  -ms-animation: scaleMinus 300ms linear;
  -o-animation: scaleMinus 300ms linear;
  animation: scaleMinus 300ms linear;  
}

</style>
</head>

<body>
<center>
<div id='id_ram0'>
    <div class='lab3' id='id_status'>Подключение</div>
    <div class='lab1'>
    <h1>Температура в комнате<div class='ram1' onclick="EnableChart(0)"><div class='icoCH'></div></div></h1>
    <div id='id_modT1'><div class="inn">Датчик не подключен</div></div><canvas id='chart_T1'></canvas></div>
    
    <div class='lab1'><h1>Температура на улице<div class='ram1' onclick="EnableChart(1)">
    <div class='icoCH'></div></div></h1>
    <div id='id_modT2'><div class="inn">Датчик не подключен</div></div><canvas id='chart_T2'></canvas></div>
    
    <div class='lab2'><h1>Разница температур: <a id='stRT'></a> &degC</h1></div>
    
    <div class='lab1'><h1>Атмосферное давление<div class='ram1' onclick="EnableChart(2)">
    <div class='icoCH'></div></div></h1>
    <div id='id_modBMP'><div class="inn">Датчик не подключен</div></div><canvas id='chart_BMP'></canvas></div>
    
    <div class='lab1'><h1>Влажность в комнате<div class='ram1' onclick="EnableChart(3)">
    <div class='icoCH'></div></h1>
    <div id='id_modH'><div class="inn">Датчик не подключен</div></div><canvas id='chart_H'></canvas></div>
    
    <div class='lab1'><h1>Напряжение в сети<div class='ram1' onclick="EnableChart(4)">
    <div class='icoCH'></div></div></h1>
    <div id='id_modV'><div class="inn">Датчик не подключен</div></div><canvas id='chart_V'></canvas></div>
    
    <div class='lab1'><h1>Текущая мощность<div class='ram1'><div class='icoCH'></div></div></h1>
    <div id='id_modP'><div class="inn">Датчик не подключен</div></div><canvas id='chart_P'></canvas></div>
</div>

<div id='id_ram_canvas'>
    <div class='ram2' onclick="DisableChart()"><div class='icoBack'></div></div>
    <div class='ram2' onclick="MenuInterval(1)"><div class='icoUpdate'></div></div>
    <div class='b0'>
    <select id='id_menuCH' class='ed' onchange="MenuInterval(1)">
    <option value='1'>Температура в комнате</option>
    <option value='2'>Температура на улице</option>
    <option value='3'>Атмосферное давление</option>
    <option value='4'>Влажность в комнате</option>
    <option value='5'>Напряжение в сети</option>
    <option value='6' disabled>Текущая мощность</option>
    </select></div>
    <div id='id_Load'><div class='loader' id='id_loader'></div><div class='b1'>Загрузка... </div></div>
    <div id='id_Interval'><div class='b0'><p>Интервал</p></div>
    <select id='id_menu' class='ed' onchange="MenuInterval(0)">
    <option value='1'>12 часов</option>
    <option value='2'>1 день</option>
    <option value='3' selected>3 дня</option>
    <option value='4'>7 дней</option>
    <option value='5'>30 дней</option>
    </select>
    </div>
    <canvas id='id_canvas'></canvas>
</div>
<div class='lab2'>Версия: 20190623-1827</div>
</center>
</body>

<script type="text/javascript" src="mqttws31.js"></script>
<script type="text/javascript" src="gauge.min.js"></script>
<script type="text/javascript" src="moment.min.js"></script>
<script type="text/javascript" src="сhart.min.js"></script>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript">

//=============================================================================
if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
  //alert('код для мобильных устройств');
  id_ram_canvas.style.margin = '0 0 12px 0';
  id_ram_canvas.style.width = '550px';
} else {
  //alert('код для обычных устройств');
}

//=============================================================================
var mod1 = 0, mod2 = 0, temp1 = 0, temp2 = -20, humidity = 0, volt = 150, bmp = 720;

var PS1 = new RadialGauge({
    renderTo: 'chart_T1',
    width: 250,
    height: 250,
    minValue: 0,
    maxValue: 40,
    majorTicks: ['0','5','10','15','20','25','30','35','40'],
    minorTicks: 5,
    strokeTicks: false,
    highlights  : [
        { from : 28,  to : 30, color : 'rgba(255,153,0,.75)' },
        { from : 30, to : 40, color : 'rgba(220,57,18,.75)' }
    ],
    valueInt: 1,
    valueDec: 1,
    colorPlate: "#f7f7f7",
    colorMajorTicks: "#333333",
    colorMinorTicks: "#333333",
    colorNumbers: "#333333",
    colorValueText: "#333333",
    colorValueBoxRect: "transparent",
    colorValueBoxRectEnd: "transparent",
    colorValueBoxBackground: "transparent",
    colorValueBoxShadow: false,
    colorValueTextShadow: false,
    colorNeedleShadowUp: true,
    colorNeedleShadowDown: false,
    colorNeedle: "rgba(200, 50, 50, .75)",
    colorNeedleEnd: "rgba(200, 50, 50, .75)",
    borderShadowWidth: 6,
    needleType: "arrow",
    needleWidth: 6,
    needleCircleSize: 12,
    animationDuration: 300,
    animationRule: "dequint",
    fontNumbersSize: 24,
    fontValueSize: 46,
    animatedValue: true
});

var PS2 = new RadialGauge({
    renderTo: 'chart_T2',
    width: 250,
    height: 250,
    value: -40,
    minValue: -40,
    maxValue: 40,
    majorTicks: ['-40','-30','-20','-10','0','10','20','30','40'],
    minorTicks: 10,
    strokeTicks: false,
    highlights  : [
        { from : 28,  to : 30, color : 'rgba(255,153,0,.75)' },
        { from : 30, to : 40, color : 'rgba(220,57,18,.75)' }
    ],
    valueInt: 1,
    valueDec: 1,
    colorPlate: "#f7f7f7",
    colorMajorTicks: "#333333",
    colorMinorTicks: "#333333",
    colorNumbers: "#333333",
    colorValueText: "#333333",    
    colorValueBoxRect: "transparent",
    colorValueBoxRectEnd: "transparent",
    colorValueBoxBackground: "transparent",
    colorValueBoxShadow: false,
    colorValueTextShadow: false,
    colorNeedleShadowUp: true,
    colorNeedleShadowDown: false,
    colorNeedle: "rgba(200, 50, 50, .75)",
    colorNeedleEnd: "rgba(200, 50, 50, .75)",
    borderShadowWidth: 6,
    needleType: "arrow",
    needleWidth: 6,
    needleCircleSize: 12,
    animationDuration: 300,
    animationRule: "dequint",
    fontNumbersSize: 24,
    fontValueSize: 46,
    animatedValue: true
  });

var PS3 = new RadialGauge({
    renderTo: 'chart_H',
    width: 250,
    height: 250,
    minValue: 0,
    maxValue: 100,
    majorTicks: ['0','10','20','30','40','50','60','70','80','90','100'],
    minorTicks: 10,
    strokeTicks: false,
    highlights: false,
    valueInt: 1,
    valueDec: 1,
    colorPlate: "#f7f7f7",
    colorMajorTicks: "#333333",
    colorMinorTicks: "#333333",
    colorNumbers: "#333333",
    colorValueText: "#333333",
    colorValueBoxRect: "transparent",
    colorValueBoxRectEnd: "transparent",
    colorValueBoxBackground: "transparent",
    colorValueBoxShadow: false,
    colorValueTextShadow: false,
    colorNeedleShadowUp: true,
    colorNeedleShadowDown: false,
    colorNeedle: "rgba(200, 50, 50, .75)",
    colorNeedleEnd: "rgba(200, 50, 50, .75)",
    borderShadowWidth: 6,
    needleType: "arrow",
    needleWidth: 6,
    needleCircleSize: 12,
    animationDuration: 300,
    animationRule: "dequint",
    fontNumbersSize: 24,
    fontValueSize: 46,
    animatedValue: true
  });

  var PS4 = new RadialGauge({
    renderTo: 'chart_V',
    width: 250,
    height: 250,
    value:150,
    minValue: 150,
    maxValue: 250,
    majorTicks: ['150','','170','','190','','210','','230','','250'],
    minorTicks: 10,
    strokeTicks: false,
    //highlights: false,
    highlights  : [
        { from : 150,  to : 170, color: 'rgba(220,57,18,.75)' },
        { from : 170, to : 180, color: 'rgba(255,153,0,.75)'  }
    ],
    valueInt: 1,
    valueDec: 1,
    colorPlate: "#f7f7f7",
    colorMajorTicks: "#333333",
    colorMinorTicks: "#333333",
    colorNumbers: "#333333",
    colorValueText: "#333333",
    colorValueBoxRect: "transparent",
    colorValueBoxRectEnd: "transparent",
    colorValueBoxBackground: "transparent",
    colorValueBoxShadow: false,
    colorValueTextShadow: false,
    colorNeedleShadowUp: true,
    colorNeedleShadowDown: false,
    colorNeedle: "rgba(200, 50, 50, .75)",
    colorNeedleEnd: "rgba(200, 50, 50, .75)",
    borderShadowWidth: 6,
    needleType: "arrow",
    needleWidth: 6,
    needleCircleSize: 12,
    animationDuration: 300,
    animationRule: "dequint",
    fontNumbersSize: 24,
    fontValueSize: 46,
    animatedValue: true
  });

var PS5 = new RadialGauge({
    renderTo: 'chart_BMP',
    width: 250,
    height: 250,
    minValue: 720,
    maxValue: 790,
    majorTicks: ['720','730','740','750','760','770','780','790'],
    minorTicks: 10,
    strokeTicks: false,
    highlights: false,
    valueInt: 1,
    valueDec: 1,
    colorPlate: "#f7f7f7",
    colorMajorTicks: "#333333",
    colorMinorTicks: "#333333",
    colorNumbers: "#333333",
    colorValueText: "#333333",
    colorValueBoxRect: "transparent",
    colorValueBoxRectEnd: "transparent",
    colorValueBoxBackground: "transparent",
    colorValueBoxShadow: false,
    colorValueTextShadow: false,
    colorNeedleShadowUp: true,
    colorNeedleShadowDown: false,
    colorNeedle: "rgba(200, 50, 50, .75)",
    colorNeedleEnd: "rgba(200, 50, 50, .75)",
    borderShadowWidth: 6,
    needleType: "arrow",
    needleWidth: 6,
    needleCircleSize: 12,
    animationDuration: 300,
    animationRule: "dequint",
    fontNumbersSize: 24,
    fontValueSize: 46,
    animatedValue: true
  });

var PS6 = new RadialGauge({
    renderTo: 'chart_P',
    width: 250,
    height: 250,
    minValue: 0,
    maxValue: 100,
    majorTicks: ['0','10','20','30','40','50','60','70','80','90','100'],
    minorTicks: 10,
    strokeTicks: false,
    highlights: false,
    valueInt: 1,
    valueDec: 1,
    colorPlate: "#f7f7f7",
    colorMajorTicks: "#333333",
    colorMinorTicks: "#333333",
    colorNumbers: "#333333",
    colorValueText: "#333333",
    colorValueBoxRect: "transparent",
    colorValueBoxRectEnd: "transparent",
    colorValueBoxBackground: "transparent",
    colorValueBoxShadow: false,
    colorValueTextShadow: false,
    colorNeedleShadowUp: true,
    colorNeedleShadowDown: false,
    colorNeedle: "rgba(200, 50, 50, .75)",
    colorNeedleEnd: "rgba(200, 50, 50, .75)",
    borderShadowWidth: 6,
    needleType: "arrow",
    needleWidth: 6,
    needleCircleSize: 12,
    animationDuration: 300,
    animationRule: "dequint",
    fontNumbersSize: 24,
    fontValueSize: 46,
    animatedValue: true
  });

 // Create a client instance
  client = new Paho.MQTT.Client(server, port, "web_" + parseInt(Math.random() * 100, 10));
  // set callback handlers
  client.onConnectionLost = onConnectionLost;
  client.onMessageArrived = onMessageArrived;
  var options = {
    useSSL: true,
    userName: user,
    password: pass,
    onSuccess: onConnect,
    onFailure: doFail
  }
  // connect the client
  client.connect(options);

//=============================================================================
// called when the client connects
function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    id_status.innerHTML = "Подключен";
    //console.log("onConnect");
    client.subscribe("ESP12/Status");
    client.subscribe("ESP12/T");
    client.subscribe("ESP12/T2");
    client.subscribe("ESP12/H");
    client.subscribe("ESP12/V");
    client.subscribe("ESP12/BMP180");

    message = new Paho.MQTT.Message('0');
    message.destinationName = 'ESP12/GetStatus';
    client.send(message);
}

//=============================================================================
function doFail(e){
    //console.log('doFail:' + e.errorMessage);
    id_status.innerHTML = e.errorMessage;
    setTimeout(function(){if (flagCH == 0) {location.reload();}}, 20000);
}

//=============================================================================
// called when the client loses its connection
function onConnectionLost(e) {
    if (e.errorCode !== 0) {
      //console.log('onConnectionLost:' + e.errorMessage);
      id_status.innerHTML = e.errorMessage;
      setTimeout(function(){if (flagCH == 0) {location.reload();}}, 20000);
    }
}

//=============================================================================
// called when a message arrives
function onMessageArrived(message) {
    // console.log(message.destinationName + ':' + message.payloadString);
    
  //   if (message.destinationName == 'ESP12/Status') {
        // if (message.payloadString = '1')
        // mod1 = 0; mod2 = 0;
        // console.log('mod1=' + mod1 + ' mod2=' + mod2);
  //   }

    //температура на улице
    if (message.destinationName == 'ESP12/T2') {
        if (message.payloadString != '') {
        id_modT2.style.display = 'none'; chart_T2.style.display = 'block';
        PS2.value = message.payloadString; PS2.draw();
        }
    }
    //температура в комнате
    if (message.destinationName == 'ESP12/T') {
        if (message.payloadString != '') {
        id_modT1.style.display = 'none'; chart_T1.style.display = 'block';
        PS1.value = message.payloadString; PS1.draw(); 
        }
    }
    //влажность в комнате
    if (message.destinationName == 'ESP12/H') {
        if (message.payloadString != '') {
        id_modH.style.display = 'none'; chart_H.style.display = 'block';
        PS3.value = message.payloadString; PS3.draw(); 
        }
    }
    //напряжение в сети
    if (message.destinationName == 'ESP12/V') {
        if (message.payloadString != '') {
        id_modV.style.display = 'none'; chart_V.style.display = 'block';
        PS4.value = message.payloadString; PS4.draw();   
        }
    }
    //атмосферное давление
    if (message.destinationName == 'ESP12/BMP180') {
        if (message.payloadString != '') {
        id_modBMP.style.display = 'none'; chart_BMP.style.display = 'block';
        PS5.value = message.payloadString; PS5.draw();  
        }   
    }
    //setTimeout(function(){
        //if (mod1 = 0) { id_modT1.style.display = 'block'; chart_T1.style.display = 'none';}
        //if (mod2 = 0) { id_modT2.style.display = 'block'; chart_T2.style.display = 'none';}
    //},30000);}

    var RT = parseFloat(PS2.value) - parseFloat(PS1.value);
    RT = RT.toFixed(1);
    if (RT < 0) {RT = RT/-1;}  
    stRT.innerHTML = RT;
    PS6.draw();
}

//=============================================================================
    var res = [], interval = 0, flagCH = 0, f00 = 0, f01 = 0, f02 = 0, f03 = 0, f04 = 0, 
    in12 = 0, in1 = 0, in3 =0, in7 = 0; in30 = 0;
    var off12 = new Date();
    var off1 = new Date();
    var off3 = new Date();
    var off7 = new Date();
    var off30 = new Date();

    dateOffset = (24*60*60*1000) * 3; //3 days
    var DateMAX = new Date();
    var DateMIN = new Date();
    DateMIN.setTime(DateMAX.getTime() - dateOffset);

    var color = Chart.helpers.color;
    var config = {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                backgroundColor: color('#434343').alpha(0.1).rgbString(),
                borderColor: '#434343',
                pointRadius: 0,
                hitRadius: 4,
                borderWidth: 1,
                fill: false,
                data: [],
            }]
        },
        options: {
            title: { display: false },
            responsive: true,
            responsiveAnimationDuration: 0,     // animation duration after a resize
            animation: { duration: 0 },         // general animation time    
            hover: { animationDuration: 0 },    // duration of animations when hovering an item
            legend: { display: false },
            tooltips: { displayColors: false },

            elements: {
                line: { tension: 0 }            // disables bezier curves
            },
            scales: {
                xAxes: [{
                    type: 'time',
                    time: { 
                        min: DateMIN,
                        max: DateMAX,
                        tooltipFormat: 'DD.MM.YYYY, HH:mm:ss',
                        displayFormats: {
                            hour: 'DD MMM, HH:mm', 
                            day: 'DD MMM', 
                            week: 'DD MMM',
                            month: 'MMM YYYY'
                        }
                    }
                }],
                yAxes: [{
                    ticks: {
                        min: 150,
                        max: 260,
                        stepSize: 10
                    }
                }]
            }
        }
    };

//=============================================================================
function EnableChart(num) {
    id_ram_canvas.classList.remove("minus");
    id_ram_canvas.classList.add("plus");
    id_ram_canvas.style.display='block';
    id_ram0.style.display='none';
    var ctx = document.getElementById('id_canvas').getContext('2d');
    window.myLine = new Chart(ctx, config);
    flagCH = 1;
    id_menuCH.options.selectedIndex = num;
    UpdateChart(num);
}

//=============================================================================
function DisableChart() {
    id_ram_canvas.classList.remove("plus");
    id_ram_canvas.classList.add("minus");
    f00 = 0; f01 = 0; f02 = 0; f03 = 0; f04 = 0;
    for (var i = 0; i < interval; i++) {
            config.data.datasets.forEach(function(dataset) { dataset.data.pop(); });
        }
    setTimeout(function(){
        window.myLine.update();
        window.myLine.destroy();
        id_ram_canvas.style.display='none';
        id_ram0.style.display='block';
        flagCH = 0;
    }, 300);
}

//=============================================================================
function GetInterval(days) {
    dateOffset = (24*60*60*1000) * days; //days
    DateMAX = new Date();
    var ret = new Date();
    ret.setTime(DateMAX.getTime() - dateOffset);
    return ret;
}

//=============================================================================
function MenuInterval(upd) {
    if (upd == 1) {f00 = 0; f01 = 0; f02 = 0; f03 = 0; f04 = 0;}
    config.options.scales.xAxes[0].time.max = DateMAX;
    switch (id_menu.options.selectedIndex) {
    case 0: config.options.scales.xAxes[0].time.min = off12; break; //12 часов
    case 1: config.options.scales.xAxes[0].time.min = off1; break;  //1 день
    case 2: config.options.scales.xAxes[0].time.min = off3; break;  //3 дня
    case 3: config.options.scales.xAxes[0].time.min = off7; break;  //7 дней
    case 4: config.options.scales.xAxes[0].time.min = off30; break; //30 дней
    }
    id_Interval.style.display='none';
    id_Load.style.display='block';
    setTimeout(function(){UpdateChart(id_menuCH.options.selectedIndex);}, 20); 
}

//=============================================================================
function UpdateChart(ch) {
    switch (ch) {
    case 0:
        config.data.datasets[0].label = 'Температура';
        config.options.scales.yAxes[0].ticks.min = 0;
        config.options.scales.yAxes[0].ticks.max = 30;
        config.options.scales.yAxes[0].ticks.stepSize = 5;
        if (f00 == 1) { LoadChart(1);} else { GetData(1, 1); f00 = 1;}
        break;
    case 1:
        config.data.datasets[0].label = 'Температура';
        config.options.scales.yAxes[0].ticks.min = -20;
        config.options.scales.yAxes[0].ticks.max = 40;
        config.options.scales.yAxes[0].ticks.stepSize = 5;
        if (f01 == 1) { LoadChart(1);} else { GetData(2, 1); f01 = 1;}
        break;
    case 2:
        config.data.datasets[0].label = 'Давление';
        config.options.scales.yAxes[0].ticks.min = 730;
        config.options.scales.yAxes[0].ticks.max = 780;
        config.options.scales.yAxes[0].ticks.stepSize = 10;
        if (f02 == 1) { LoadChart(2);} else { GetData(2, 2); f02 = 1;}
        break;
    case 3:
        config.data.datasets[0].label = 'Влажность';
        config.options.scales.yAxes[0].ticks.min = 0;
        config.options.scales.yAxes[0].ticks.max = 100;
        config.options.scales.yAxes[0].ticks.stepSize = 10;
        if (f03 == 1) { LoadChart(2);} else { GetData(1, 2); f03 = 1;}
        break;
    case 4:
        config.data.datasets[0].label = 'Напряжение';
        config.options.scales.yAxes[0].ticks.min = 150;
        config.options.scales.yAxes[0].ticks.max = 260;
        config.options.scales.yAxes[0].ticks.stepSize = 10;
        if (f04 == 1) { LoadChart(3);} else { GetData(1, 3); f04 = 1;}
        break;
    }
}

//=============================================================================
function LoadChart(idx) {
    for (var i = 0; i < interval; i++) {
        //config.data.labels.splice(-1, 1); // remove the label first
        config.data.labels.shift();
        config.data.datasets.forEach(function(dataset) { dataset.data.pop(); });
    }
    switch (id_menu.options.selectedIndex) {
    case 0: interval = in12; break;
    case 1: interval = in1; break;
    case 2: interval = in3; break;
    case 3: interval = in7; break;
    case 4: interval = in30; break;
    }
    if (interval == 0) {interval = res.length;}
    for (var i = res.length-interval; i < res.length; i++) {
        config.data.labels.push(res[i][0]);                 //x
        config.data.datasets[0].data.push(res[i][idx]);     //y
        //config.data.datasets[0].data.push({ x: res[i][0], y: res[i][idx] });
    }
    window.myLine.update();
    id_Interval.style.display='block';
    id_Load.style.display='none';
}

//=============================================================================
function GetData(mod, idx) {
    off12 = GetInterval(0.5);
    off1 = GetInterval(1);
    off3 = GetInterval(3);
    off7 = GetInterval(7);
    off30 = GetInterval(30);
    f00 = 0; f01 = 0; f02 = 0; f03 = 0; f04 = 0;
    in12 = 0; in1 = 0; in3 = 0; in7 = 0; in30 = 0; 
    id_Interval.style.display='none';
    id_Load.style.display='block';
    if (mod == 1) { appURL = gsURL + '?mod=1';  }
    if (mod == 2) { appURL = gsURL + '?mod=2';  }
    xhr = new XMLHttpRequest();
    xhr.open('GET', appURL);
    xhr.onreadystatechange = function() {
    if (xhr.readyState !== 4) return;
    if (xhr.status == 200) {
        try {
            //console.log(xhr.responseText);
            var tab = JSON.parse(xhr.responseText);
            res = tab["result"];
            var cmp = 0;
            for (var i = 1; cmp < 1; i++) {
                if (off12 > new Date(res[res.length-i][0]) && in12 == 0) { in12 = i; }
                if (off1 > new Date(res[res.length-i][0]) && in1 == 0) { in1 = i; }
                if (off3 > new Date(res[res.length-i][0]) && in3 == 0) { in3 = i; }
                if (off7 > new Date(res[res.length-i][0]) && in7 == 0) { in7 = i; }
                if (off30 > new Date(res[res.length-i][0])) { cmp = 1; }
                if (res.length-i == 0) {cmp = 1;}
                in30 = i;
            }
            LoadChart(idx);
        } catch(e) {console.log(e);}
        id_Interval.style.display='block';
        id_Load.style.display='none';
        } 
   }
   xhr.send();
}
</script>
</html>