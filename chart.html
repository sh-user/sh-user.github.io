<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>ESP Chart</title>

<style>
body {color: #455a64; font-family: Helvetica; font-size: 15px;}
canvas {-moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;}
h1 { font-size: 18px; font-weight:normal; padding: 6px 0 0 42px;}

@-webkit-keyframes loader { 100% {-webkit-transform: rotate(360deg); transform: rotate(360deg);}}
@-moz-keyframes loader { 100% {-moz-transform: rotate(360deg); transform: rotate(360deg);}}
@keyframes loader { 100% { transform: rotate(360deg);}}
.loader {float: left; width: 24px; height: 24px; border: 4px solid #000; border-left-color: #333; border-bottom-color: #555; border-right-color: transparent; border-radius: 100%; -webkit-animation: loader 0.8s infinite linear; -moz-animation: loader 0.8s infinite linear; animation: loader 0.8s infinite linear;}

</style>
</head>

<body>
	<div class='loader' id='id_loader'></div>
	<div id='id_h1'><h1 id='id_prorgess'></h1></div>
	<div style="width: 90%"><canvas id="canvas"></canvas></div>
	
<script type="text/javascript" src="moment.min.js"></script>
<script type="text/javascript" src="сhart.min.js"></script>
<script type="text/javascript">

	var color = Chart.helpers.color;
	var config = {
			type: 'line',
			data: {
				datasets: [{
					label: 'Volt',
					backgroundColor: color('#455a64').alpha(0.1).rgbString(),
					borderColor: '#455a64',
					pointRadius: 0,
					hitRadius: 4,
					borderWidth: 1,
					fill: false,
					data: [],
				}]
			},
			options: {
				responsive: true,
				responsiveAnimationDuration: 0, 	// animation duration after a resize
				animation: { duration: 0, }, 		// general animation time    
        		hover: { animationDuration: 0, }, 	// duration of animations when hovering an item
                legend: { display: false, },
                tooltips: { displayColors: false, },

				title: {
					display: true,
					text: 'Напряжение в сети'
				},
				elements: {
            		line: {	tension: 0, }			// disables bezier curves
        		},
				scales: {
					xAxes: [{
						type: 'time',
						display: true,
					}],
					yAxes: [{
						display: true,
					}]
				}
			}
		};

	window.onload = function() {
		var ctx = document.getElementById('canvas').getContext('2d');
		window.myLine = new Chart(ctx, config);
	};

	id_prorgess.innerHTML = 'Загрузка...';
	//var app = "https://script.google.com/macros/s/AKfycbymMHRBn2a39ObPxFhRYussNWejaEgDpCjf6FF4OlWsLHbScOR3/exec";
   	var app = "https://script.google.com/macros/s/AKfycbzcBzCF1UHLopqIbyHNvfEjMEnpuhjR5lFIM6H-WxX1xiH-dSE/exec";
   	xhr = new XMLHttpRequest();
   	xhr.open('GET', app);
   	xhr.onreadystatechange = function() {
     if (xhr.readyState !== 4) return;
     if (xhr.status == 200) {
        try {
        console.log(xhr.responseText);
        var tab = JSON.parse(xhr.responseText);
        var res = tab["result"];
        //var dx = moment(res[0][1]).format('DD.MM.YYYY HH:mm:ss');
        //console.log(dx); 
        for (var i = 15800; i < res.length ; i++) {
		 	config.data.datasets[0].data.push({ x: res[i][0], y: res[i][2] });
		 }
        window.myLine.update();
        id_loader.style.display='none';
        id_h1.style.display='none';
        } catch(e) {}
     } 
   }
   xhr.send();

</script>
</body>
</html>