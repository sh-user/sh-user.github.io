<!DOCTYPE html><html lang='ru'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=384'>
<title>MQTT Websocket</title>

<style>
body{margin:0; position:relative; background-color: #9ea7aa;}
::selection {background: #a0bbbb;}
::-moz-selection {background: #a0bbbb;}
input, textarea, button {outline: none;}

.icoH{background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDM4My4zNDQgMzgzLjM0NSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzgzLjM0NCAzODMuMzQ1OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI3My4yMTcsMTA2Ljg5OWMtMjcuMTgxLTQ0Ljg2NC01Ny40MTMtODMuNjkzLTczLjAxNi0xMDIuODQ2Yy0yLjA4OC0yLjU2NS01LjIyMS00LjA1NC04LjUyOC00LjA1MyAgIGMtMy4zMDgsMC02LjQ0LDEuNDg5LTguNTI5LDQuMDU0Yy0xNS42MDIsMTkuMTU5LTQ1LjgzNCw1OC4wMDEtNzMuMDE1LDEwMi44NjljLTM1LjAyOCw1Ny44MjMtNTIuNzg5LDEwNS42My01Mi43ODksMTQyLjA5ICAgYzAsNzQuMDcxLDYwLjI2MSwxMzQuMzMyLDEzNC4zMzIsMTM0LjMzMnMxMzQuMzMyLTYwLjI2MSwxMzQuMzMyLTEzNC4zMzJDMzI2LjAwNSwyMTIuNTI5LDMwOC4yNDYsMTY0LjcxNSwyNzMuMjE3LDEwNi44OTl6ICAgIE0yMTAuMTA2LDMzMy44NjhjLTcuODQ0LDIuMDA2LTE1Ljk4NiwzLjAyMi0yNC4yMDUsMy4wMjJjLTUwLjE4NiwwLTkxLjAxNS0zNy45MjktOTEuMDE1LTg0LjU1ICAgYzAtMTEuMjU1LDIuOTctMjQuNDA1LDguODI1LTM5LjA4M2MwLjk4OS0yLjQ4LDMuODA3LTMuODk1LDYuNTg1LTMuMjk1YzIuNzc2LDAuNTk4LDQuNjQsMy4wMTgsNC4zNTQsNS42NSAgIGMtMC4zNDIsMy4xNDgtMC41MTYsNi4yMjMtMC41MTYsOS4xMzZjMCw1MC43MzUsNDAuODgxLDkzLjIyMSw5NS4wOTMsOTguODIxYzIuNjk4LDAuMjc5LDQuODAzLDIuMjk3LDUuMDE4LDQuODEyICAgQzIxNC40NjEsMzMwLjg5NiwyMTIuNzIzLDMzMy4xOTgsMjEwLjEwNiwzMzMuODY4eiIgZmlsbD0iIzQ1NWE2NCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=);}

.icoT{background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ2NC42MDEgNDY0LjYwMSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDY0LjYwMSA0NjQuNjAxOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCI+CjxwYXRoIGQ9Ik0zMTMuNDgsMjc2LjU2OFY4MS4xNzJDMzEzLjQ4LDM2LjQxMSwyNzcuMDY5LDAsMjMyLjMwOCwwYy00NC43NiwwLTgxLjE4OCwzNi40MTEtODEuMTg4LDgxLjE3MnYxOTUuMzggIGMtMTkuNDA4LDIwLjYwNC0zMC40MjIsNDguMDUzLTMwLjQzNyw3Ni40MjVjMC4wMTUsNjEuNTM2LDUwLjA4OSwxMTEuNjA4LDExMS42MjQsMTExLjYyNCAgYzYxLjUyMS0wLjAxNiwxMTEuNTk0LTUwLjA4OCwxMTEuNjA4LTExMS42NDFDMzQzLjkwMiwzMjQuNjIxLDMzMi44ODgsMjk3LjE4OCwzMTMuNDgsMjc2LjU2OHogTTE1My43NTMsMzUyLjk5MSAgYzAuMDE1LTIyLjAwOCw4Ljk0NS00Mi40MTgsMjUuMTQxLTU3LjQzNWMzLjM3NS0zLjEzNCw1LjI5Ni03LjUyNSw1LjI5Ni0xMi4xMjZWODEuMTcyYzAtMjYuNTMsMjEuNTg4LTQ4LjEwMiw0OC4xMTgtNDguMTAyICBjMjYuNTI5LDAsNDguMTAzLDIxLjU3Miw0OC4xMDMsNDguMTAydjY2LjI2OGgtNTkuNTE5djEzNS45OTFjLTE4LjY4MywxNy4zNDEtMzAuNDIsNDIuMDQ3LTMwLjQzNyw2OS41NjEgIGMwLjAxNywzMi42NjYsMTYuNTUyLDYxLjQyNSw0MS42NzUsNzguNTI1QzE4OC45MDQsNDMxLjM4NiwxNTMuNzY4LDM5Ni4yMDIsMTUzLjc1MywzNTIuOTkxeiIgZmlsbD0iIzQ1NWE2NCIvPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K);}

.icoSign {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDIyNC43MiAyMjQuNzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDIyNC43MiAyMjQuNzI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8cGF0aCBkPSJNMTQyLjcxOSwxNzMuMDExYzAsMTYuNzY0LTEzLjU2NywzMC4zMjctMzAuMzMxLDMwLjMyN2MtMTYuNzQ2LDAtMzAuMzIyLTEzLjU2My0zMC4zMjItMzAuMzI3ICAgYzAtMTYuNzYsMTMuNTc3LTMwLjMyNywzMC4zMjItMzAuMzI3QzEyOS4xNTEsMTQyLjY4NCwxNDIuNzE5LDE1Ni4yNTEsMTQyLjcxOSwxNzMuMDExeiBNNDIuNjA0LDExNC42NGwyMy4yNDQsMTkuNDg1ICAgYzIzLjE5LTI3LjY4OCw2OS45NjQtMjcuNjg4LDkzLjEyNywwLjAzMmwyMy4yNzktMTkuNDI5Yy0xNy4zODUtMjAuNzktNDIuODQ0LTMyLjY5My02OS44NjEtMzIuNjkzICAgQzg1LjM4Miw4Mi4wMzUsNTkuOTQxLDkzLjkxMSw0Mi42MDQsMTE0LjY0eiBNMCw3MS4xOThsMjIuNDc5LDIwLjM3NGMyMi45NTEtMjUuMzUyLDU1LjcyMy0zOS44NjQsODkuOTA5LTM5Ljg2NCAgIGMzNC4xNzcsMCw2Ni45MzEsMTQuNTEyLDg5Ljg4MywzOS44MDNsMjIuNDQ5LTIwLjM3NGMtMjguNjk4LTMxLjYyOS02OS42MjMtNDkuNzU2LTExMi4zMjctNDkuNzU2ICAgQzY5LjY1NiwyMS4zODIsMjguNjk4LDM5LjU2OSwwLDcxLjE5OHoiIGZpbGw9IiM0NTVhNjQiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)}

.icoFoto {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDQ1LjE2IDQ1LjE2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NS4xNiA0NS4xNjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxnPgoJCTxwYXRoIGQ9Ik0yMi41OCwxMS4yNjljLTYuMjM3LDAtMTEuMzExLDUuMDc1LTExLjMxMSwxMS4zMTJzNS4wNzQsMTEuMzEyLDExLjMxMSwxMS4zMTJjNi4yMzYsMCwxMS4zMTEtNS4wNzQsMTEuMzExLTExLjMxMiAgICBTMjguODE2LDExLjI2OSwyMi41OCwxMS4yNjl6IiBmaWxsPSIjNDU1YTY0Ii8+CgkJPGc+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTIyLjU4LDcuOTQ0Yy0xLjIxOSwwLTIuMjA3LTAuOTg4LTIuMjA3LTIuMjA2VjIuMjA3QzIwLjM3MywwLjk4OCwyMS4zNjEsMCwyMi41OCwwYzEuMjE5LDAsMi4yMDcsMC45ODgsMi4yMDcsMi4yMDcgICAgICB2My41MzFDMjQuNzg3LDYuOTU2LDIzLjc5OCw3Ljk0NCwyMi41OCw3Ljk0NHoiIGZpbGw9IiM0NTVhNjQiLz4KCQkJPC9nPgoJCQk8Zz4KCQkJCTxwYXRoIGQ9Ik0yMi41OCwzNy4yMTVjLTEuMjE5LDAtMi4yMDcsMC45ODgtMi4yMDcsMi4yMDd2My41M2MwLDEuMjIsMC45ODgsMi4yMDgsMi4yMDcsMi4yMDhjMS4yMTksMCwyLjIwNy0wLjk4OCwyLjIwNy0yLjIwOCAgICAgIHYtMy41M0MyNC43ODcsMzguMjAzLDIzLjc5OCwzNy4yMTUsMjIuNTgsMzcuMjE1eiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTMyLjkyOCwxMi4yMzFjLTAuODYxLTAuODYyLTAuODYxLTIuMjU5LDAtMy4xMjFsMi40OTctMi40OTdjMC44NjEtMC44NjEsMi4yNTktMC44NjEsMy4xMjEsMCAgICAgIGMwLjg2MiwwLjg2MiwwLjg2MiwyLjI2LDAsMy4xMjFsLTIuNDk3LDIuNDk3QzM1LjE4OCwxMy4wOTMsMzMuNzkxLDEzLjA5MywzMi45MjgsMTIuMjMxeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTEyLjIzMSwzMi45M2MtMC44NjItMC44NjMtMi4yNTktMC44NjMtMy4xMjEsMGwtMi40OTcsMi40OTZjLTAuODYxLDAuODYxLTAuODYyLDIuMjYsMCwzLjEyMSAgICAgIGMwLjg2MiwwLjg2MSwyLjI2LDAuODYxLDMuMTIxLDBsMi40OTctMi40OThDMTMuMDkzLDM1LjE4OCwxMy4wOTMsMzMuNzksMTIuMjMxLDMyLjkzeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTM3LjIxNSwyMi41OGMwLTEuMjE5LDAuOTg4LTIuMjA3LDIuMjA3LTIuMjA3aDMuNTMxYzEuMjE5LDAsMi4yMDcsMC45ODgsMi4yMDcsMi4yMDdjMCwxLjIxOS0wLjk4OCwyLjIwNi0yLjIwNywyLjIwNiAgICAgIGgtMy41MzFDMzguMjAzLDI0Ljc4NiwzNy4yMTUsMjMuNzk5LDM3LjIxNSwyMi41OHoiIGZpbGw9IiM0NTVhNjQiLz4KCQkJPC9nPgoJCQk8Zz4KCQkJCTxwYXRoIGQ9Ik03Ljk0NCwyMi41OGMwLTEuMjE5LTAuOTg4LTIuMjA3LTIuMjA3LTIuMjA3aC0zLjUzQzAuOTg4LDIwLjM3MywwLDIxLjM2MSwwLDIyLjU4YzAsMS4yMTksMC45ODgsMi4yMDYsMi4yMDcsMi4yMDYgICAgICBoMy41MzFDNi45NTYsMjQuNzg2LDcuOTQ0LDIzLjc5OSw3Ljk0NCwyMi41OHoiIGZpbGw9IiM0NTVhNjQiLz4KCQkJPC9nPgoJCQk8Zz4KCQkJCTxwYXRoIGQ9Ik0zMi45MjgsMzIuOTNjMC44NjItMC44NjEsMi4yNi0wLjg2MSwzLjEyMSwwbDIuNDk3LDIuNDk3YzAuODYyLDAuODYsMC44NjIsMi4yNTksMCwzLjEycy0yLjI1OSwwLjg2MS0zLjEyMSwwICAgICAgbC0yLjQ5Ny0yLjQ5N0MzMi4wNjYsMzUuMTg4LDMyLjA2NiwzMy43OTEsMzIuOTI4LDMyLjkzeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTEyLjIzMSwxMi4yMzFjMC44NjItMC44NjIsMC44NjItMi4yNTksMC0zLjEyMUw5LjczNCw2LjYxNGMtMC44NjItMC44NjItMi4yNTktMC44NjItMy4xMjEsMCAgICAgIGMtMC44NjIsMC44NjEtMC44NjIsMi4yNTksMCwzLjEybDIuNDk3LDIuNDk3QzkuOTcyLDEzLjA5NCwxMS4zNjksMTMuMDk0LDEyLjIzMSwxMi4yMzF6IiBmaWxsPSIjNDU1YTY0Ii8+CgkJCTwvZz4KCQk8L2c+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)}

.icoV {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCI+CjxnPgoJPGc+CgkJPHBhdGggZD0iTTQwMC4yNjgsMTc1LjU5OWMtMS4zOTktMy4wMDQtNC40MTItNC45MzItNy43MzEtNC45MzJoLTEwMS4xMmw5OS43OTctMTU3LjU2OGMxLjY2NC0yLjYyOCwxLjc2Ni01Ljk1NiwwLjI2NS04LjY3OCAgICBDMzg5Ljk3NywxLjY5LDM4Ny4xMDksMCwzODQuMDAzLDBIMjQ3LjQ3Yy0zLjIzNCwwLTYuMTg3LDEuODI2LTcuNjM3LDQuNzE5bC0xMjgsMjU2Yy0xLjMyMywyLjYzNy0xLjE3OCw1Ljc3NywwLjM3NSw4LjI5NCAgICBjMS41NjIsMi41MTcsNC4zMDEsNC4wNTMsNy4yNjIsNC4wNTNoODcuNzQ4bC05NS42MTYsMjI3LjA4OWMtMS42MywzLjg4My0wLjE3OSw4LjM4OCwzLjQxMywxMC41OSAgICBjMS4zODIsMC44NDUsMi45MTgsMS4yNTQsNC40NDYsMS4yNTRjMi40NDksMCw0Ljg2NC0xLjA1LDYuNTM3LTMuMDI5bDI3My4wNjctMzI0LjI2NyAgICBDNDAxLjIwNiwxODIuMTYxLDQwMS42NjcsMTc4LjYxMSw0MDAuMjY4LDE3NS41OTl6IiBmaWxsPSIjNDU1YTY0Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)}

.icoPIR {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4Ij4KPGc+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZD0iTTE3MC42NjcsMjg1djEzNC4wMWMxMC4zNTQsMi43ODEsMzUuNTgzLDcuNjU2LDg1LjM1NCw3LjY1NmM0OS42NjcsMCw3NC44NzUtNC44NTQsODUuMzEzLTcuNjY3VjI4NC45OSAgICAgYy0xMC4zNDQtMi43ODEtMzUuNTYzLTcuNjU2LTg1LjMzMy03LjY1NkMyMDYuMzIzLDI3Ny4zMzMsMTgxLjExNSwyODIuMTg4LDE3MC42NjcsMjg1eiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8cGF0aCBkPSJNNDM3LjMzMywwSDc0LjY2N0M2OC43NzEsMCw2NCw0Ljc3MSw2NCwxMC42Njd2NDIuNjY3QzY0LDU5LjIyOSw2OC43NzEsNjQsNzQuNjY3LDY0SDIyNHY0My41MSAgICAgYy02Ni40NjEsMy42NzgtOTMuMjM4LDE4LjczOC0xMTMuNDY5LDMwLjEyNWwtMy44MzMsMi4xNTZjLTEzLjE3Nyw3LjMxMy0yMS4zNjUsMjEuNDktMjEuMzY1LDM2Ljk3OXYyNjUuMTI1ICAgICBjMCwxNS40OSw4LjE4OCwyOS42NjcsMjEuMzY1LDM2Ljk3OWwzLjgzMywyLjE1NkMxMzMuNzQsNDk0LjA5NCwxNjUuNTIxLDUxMiwyNTYsNTEyczEyMi4yNi0xNy45MDYsMTQ1LjQ2OS0zMC45NjlsMy44MzMtMi4xNTYgICAgIGMxMy4xNzctNy4zMTMsMjEuMzY1LTIxLjQ5LDIxLjM2NS0zNi45NzlWMTc2Ljc3MWMwLTE1LjQ5LTguMTg4LTI5LjY2Ny0yMS4zNjUtMzYuOTc5bC0zLjgzMy0yLjE1NiAgICAgYy0yMC4yMy0xMS4zODctNDcuMDA4LTI2LjQ0Ny0xMTMuNDY5LTMwLjEyNVY2NGgxNDkuMzMzQzQ0My4yMjksNjQsNDQ4LDU5LjIyOSw0NDgsNTMuMzMzVjEwLjY2N0M0NDgsNC43NzEsNDQzLjIyOSwwLDQzNy4zMzMsMCAgICAgeiBNMjU2LDE3MC42NjdjMTEuNzYsMCwyMS4zMzMsOS41NzMsMjEuMzMzLDIxLjMzM1MyNjcuNzYsMjEzLjMzMywyNTYsMjEzLjMzM1MyMzQuNjY3LDIwMy43NiwyMzQuNjY3LDE5MiAgICAgUzI0NC4yNCwxNzAuNjY3LDI1NiwxNzAuNjY3eiBNMzU2Ljc3MSwyNjcuNzkyYzMuNjE1LDEuODEzLDUuODk2LDUuNSw1Ljg5Niw5LjU0MnYxNDkuMzMzYzAsNC4wNDItMi4yODEsNy43MjktNS44OTYsOS41NDIgICAgIEMzNTQuMzY1LDQzNy40MTcsMzMxLjA0Miw0NDgsMjU2LjAyMSw0NDhzLTk4LjM3NS0xMC41ODMtMTAwLjc5Mi0xMS43OTJjLTMuNjE1LTEuODAyLTUuODk2LTUuNS01Ljg5Ni05LjU0MlYyNzcuMzMzICAgICBjMC00LjA0MiwyLjI4MS03LjcyOSw1Ljg5Ni05LjU0MkMxNTcuNjQ2LDI2Ni41ODMsMTgwLjk3OSwyNTYsMjU2LDI1NlMzNTQuMzU0LDI2Ni41ODMsMzU2Ljc3MSwyNjcuNzkyeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)}

.icoT, .icoH, .icoSign, .icoFoto, .icoV, .icoPIR {float: left; width: 32px; height: 32px; margin: -3px 10px 0 0;}

#lay1 {width: 354px; padding: 0; margin: 12px auto; border: 1px solid gray; border-radius: 4px;
box-shadow: 0 0 10px rgba(0,0,0,0.3); -moz-box-shadow: 0 0 10px rgba(0,0,0,0.3); -webkit-box-shadow: 0 0 10px rgba(0,0,0,0.3);
background: rgba(207,216,220,1); /* Цвет фона и значение прозрачности */
color: #455a64; font-family: Helvetica; font-size: 18px;}

.lay2 {width: 40px; float: right;}
.lay3 {width: 32px; float: right;}
.ram0 {width: 354px; margin: 0; overflow: hidden; padding: 14px 12px 0 12px; font-family: Helvetica; font-size: 15px;}

h1 {font-size: 30px; margin: -4px 0 0 0; }
h3 {width: 354px; margin: 0 4px 12px 0;}
h1, h3 {font-weight:normal;}

.lab1 {width: 50%; float: left;  margin: 0 0 12px 0;}
.lab2 {width: 100%; float: left;  margin: 0 0 12px 0;}
.block1 { border: solid 1px #2F4F4F; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);}

.ex1 {position: relative; width: 30px; height: 30px; background-color: white; border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);}
.ex1::before, .ex1::after { position: absolute;	top: 14px; left: 8px; width: 14px; height: 3px;	content: '';
    background-color: #2F4F4F;}
.ex1::before {-ms-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); transform: rotate(-45deg);}
.ex1::after {-ms-transform: rotate(45deg); -webkit-transform: rotate(45deg);	transform: rotate(45deg);}
.ex1:active::before, .ex1:active::after { background-color: white; }
.ex1:active {background-color: #2F4F4F;}

input[type='checkbox'] { display: none;}
input[type='checkbox']:checked ~ .toggle { background: #4169e1; left: 15px; transition: .2s;}
input[type='checkbox']:checked ~ .switch { background: #93AEFF; transition: .2s;}
.switch {display: block; width: 32px; height: 14px; background: #939393; border-radius: 10px;
  position: absolute; top: 0; transition: .2s;}
.toggle {height: 21px; width: 21px; border-radius: 50%; background: white; position: absolute;
  top: -4px; left: -4px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); transition: .2s;}
.card {display: inline-block; margin: 0 4px 0 4px; width: 25px; height: 13px; text-align: center; position: relative;}

.btn {width: 100%; height: 40px; margin: 0; color: #455a64; font-family: Helvetica; font-size: 18px;
 background: linear-gradient(#F7F7F7, #DCDCDC); border: 1px solid #949494; border-radius: 2px; outline: none;}
.btn:active {background: linear-gradient(#DCDCDC, #F7F7F7);}
.btn:hover {border: 1px solid #6E6E6E;}

.ed {outline: none; resize: none;}
.ed2 {height: 24px;}
.ed,.ed2 {width: 340px; color: #455a64; font-family: Helvetica; font-size: 18px; 
border: 1px solid gray; border-radius: 4px; padding: 6px; box-shadow: 0 3px 4px rgba(0,0,0,0.1) inset;}

.ver {font-size: 14px; margin: 12px 0 12px 0;}

</style>
</head> 

<body onload='loadPAGE()'>
<table id='lay1'>
<tr><td>
<div class='ram0'>
  <h1>MQTT Websocket 
  <div class='lay3' id='id_EX' style='display: none'><div class='ex1' title='Выход' onclick="divEX()"></div></div>
  </h1></h1>
  <hr>
<div id='id_conn'><h3>Подключение...</h3></div>
<div id='id_login' style="display: none">
<form>
  <h3>Авторизация</h3>
  <p><input class='ed2' id='mq_serv' type='text' placeholder='Сервер'></p>			
  <p><input class='ed2' id='mq_port' type='text' placeholder='Порт' onkeypress="return num()"></p>
  <p><input class='ed2' id='mq_user' type='text' placeholder='Пользователь'></p>
  <p><input class='ed2' id='mq_login' type='text' placeholder='Логин'></p>			
  <p><input class='ed2' id='mq_pass' type='password' placeholder='Пароль'></p>
  <h3><label>Запомнить меня <div class='lay2'>
    <div class='card'><label for='id_SAVE'>
    <input type='checkbox' id='id_SAVE'/><span class='switch'></span><span class="toggle"></span>
    </label></div></div>
  </label></h3>	  
  <p><input class='btn' type='button' value='Войти' onClick="btnConnect()"/></p>
</form>
</div>
<div id='id_mqtt' style='display: none'>
  <h3>Статус сервера: <a id='stMQTT'></a></h3>
  <h3>Клиентов на сервере: <a id='stUSERS'></a></h3>
  <h3>Последнее обновление: <a id='time'></a></h3>
  <h3>Модуль ESP01: <a id='stESP01'></a></h3>
  <h3>Модуль ESP12: <a id='stESP12'></a></h3>
<div id='id_m1' style='display: none'>
  <div class='lab1' title='ESP01-4M'><h3>Уровень сигнала</h3><div class='icoSign'></div><h1><a id='stRSSI2'></a> dBm</h1></div>
  <div class='lab1' title='На улице'><h3>Температура</h3><div class='icoT'></div><h1><a id='stT2'></a> &degC</h1></div>
</div>
<div id='id_m2' style='display: none'>
  <div class='lab1' title='ESP12'><h3>Уровень сигнала</h3><div class='icoSign'></div><h1><a id='stRSSI'></a> dBm</h1></div>
  <div class='lab1' title='В комнате'><h3>Освещенность</h3><div class='icoFoto'></div><h1><a id='stLDR'></a></h1></div>
  <div class='lab1' title='В комнате'><h3>Влажность</h3><div class='icoH'></div><h1><a id='stH'></a> %</h1></div>
  <div class='lab1' title='В комнате'><h3>Температура</h3><div class='icoT'></div><h1><a id='stT'></a> &degC</h1></div>
  <div class='lab1' title='PZEM-004'><h3>Напряжение в сети</h3><div class='icoV'></div><h1><a id='stPZEM'></a> V</h1></div>
  <div class='lab1' title='HC-SR501'><h3>Датчик движения</h3><div class='icoPIR'></div><h1><a id='stPIR'></a></h1></div>
  <h3><label>Управление розеткой<div class='lay2'>
    <div class='card'><label for='id_LED'>
    <input type='checkbox' id='id_LED' onclick="checkLED()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>

  <h3><label title='Работает только в Google Chrome'>Голосовое управление <div class='lay2'>
    <div class='card'><label for='id_REC'>
    <input type='checkbox' id='id_REC' onclick="checkBX()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
<div id='id_area1' style="display: none">
  <h3>Команды: включить, выключить, температура</h3>
  <textarea readonly class='ed' id='rcmd' rows='6'></textarea>
  <div class='lab2'></div>
</div>
</div>
<h3><label>MQTT Messenger <div class='lay2'>
    <div class='card'><label for='id_MESS'>
    <input type='checkbox' id='id_MESS' onclick="checkBX()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
<div id='id_area2' style="display: none">
   <h3>Пользователь: <a id='stUSER1'></a></h3>
   <textarea readonly class='ed' id='rmess' rows='8'></textarea>
<form onsubmit="btnSendMESS(); return false">
   <p><input class='ed2' id='mq_mess' autocomplete='off' type='text' placeholder='Сообщение'>
</p>
</form>
<h3><label title='Работает только в Google Chrome'>Голосовой набор сообщения<div class='lay2'>
    <div class='card'><label for='id_RMESS'>
    <input type='checkbox' id='id_RMESS' onclick="checkBX()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
  <h3><label>Голосовой ответ<div class='lay2'>
    <div class='card'><label for='id_UTT'>
    <input type='checkbox' id='id_UTT'/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
</div>

</div>
<p class='ver'>Версия: 20192602-1549</p>
</div>
</td></tr>
</table>


<script src="mqttws31.js" type="text/javascript"></script>
<script type="text/javascript">
//=============================================================================
//глобальные переменные
var idUSER = ''; flag = ''; temp = ''; host = ''; port = 0; user = ''; US = '1'; cntREC = 0;
var login = ''; pass = ''; txtUTT = ''; flagSTOP = 0; rec_str = ''; rec_flag = ''; m01 = 0; m12 = 0;

//stT.innerHTML = '00.0';
//stH.innerHTML = '00.0';
//stT2.innerHTML = '00.0';
//stRSSI.innerHTML = '-00';
//stRSSI2.innerHTML = '-00';
//stPZEM.innerHTML = '000.0';

//=============================================================================
function playSound() {
  if (typeof window.Audio === 'function') {
    var audioElem = new Audio();
    audioElem.src = "data:audio/ogg;base64,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LI4FJBIQGgAAqgiIrghASHZKAKTv7LW/a1v//mXmecSo0jpEjAMAkiwUkUCv6FDcXf//4UcCsHBWILkb//4LwbFiigoqaC5BUU7//xvRWX/rhwViKhZHApIZTEFNRTMuOTNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUQUcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDA==";
    audioElem.play();
  }
}

//=============================================================================
function MQTTconnect() {
  // Create a client instance
  idUSER = parseInt(Math.random() * 100, 10);
  client = new Paho.MQTT.Client(host, port, 'web_' + idUSER);
  // set callback handlers
  client.onConnectionLost = onConnectionLost;
  client.onMessageArrived = onMessageArrived;

  // Connect the client, with a Last-Will-and-Testament
  //var lwt = new Paho.MQTT.Message('-');  
  //lwt.destinationName = 'ESP12/Users';

  var options = {
    useSSL: true,
    userName: login,
    password: pass,
    //willMessage: lwt,
    onSuccess: onConnect,
    onFailure: doFail,
  }
  // connect the client
  client.connect(options);
}

//=============================================================================
// called when the client connects
function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    console.log('onConnect');
    stMQTT.innerHTML='Подключен';
    id_conn.style.display='none';
    stESP01.innerHTML='Не подключен';
    stESP12.innerHTML='Не подключен';
    stUSERS.innerHTML = '1';
    client.subscribe('$SYS/broker/clients/connected');
    client.subscribe('ESP12/#');
    
    message = new Paho.MQTT.Message(' ');
    message.destinationName = 'ESP12/Status';
    client.send(message);

    id_login.style.display='none';
    id_mqtt.style.display='block';
    if (id_SAVE.checked) {
    id_EX.style.display='block';
    id_REC.checked = localStorage.getItem('reccmd'); 
    id_MESS.checked = localStorage.getItem('mess'); 
    checkBX(); }
}

//=============================================================================
function doFail(e){
    console.log(e);
    //stMQTT.innerHTML='Не подключен';
    id_login.style.display='block';
    id_conn.style.display='none';
    alert('Ошибка подключения к серверу\r\nПроверьте правильность введенных параметров и соединение с интернетом');
}

//=============================================================================
// called when the client loses its connection
function onConnectionLost(responseObject) {
    if (responseObject.errorCode !== 0) {
      console.log("onConnectionLost:"+responseObject.errorMessage);
      stMQTT.innerHTML=responseObject.errorMessage;
      //alert('Ошибка\r\n'+responseObject.errorMessage);
    }
}

//=============================================================================
function btnSH(topic, setsh) {
    message = new Paho.MQTT.Message(setsh);
    message.destinationName = topic;
    client.send(message);
}

//=============================================================================
function sendLED(ld) {
    message = new Paho.MQTT.Message(ld);
    message.destinationName = 'ESP12/SetLED';
    client.send(message);
    playSound();
}

//=============================================================================
function esp01(set) {
 if (set == 1) {stESP01.innerHTML = 'Подключен'; id_m1.style.display='block'; }
 else {stESP01.innerHTML = 'Не подключен'; id_m1.style.display='none'; }
}

//=============================================================================
function esp12(set) {
 if (set == 1) {stESP12.innerHTML = 'Подключен'; id_m2.style.display='block'; }
 else {stESP12.innerHTML = 'Не подключен'; id_m2.style.display='none'; }
}

//=============================================================================
// called when a message arrives
function onMessageArrived(message) {
	console.log(message.destinationName + ':' + message.payloadString);
	time.innerHTML = new Date().toLocaleTimeString();

	//статус модуля
	if (message.destinationName == 'ESP12/Status') {
    m12=0; m01=0;
	if (message.payloadString == '1') {m12=1; esp12(1);}
	if (message.payloadString == '2') {m01=1; esp01(1);}
	}

	//клиентов на сервере
    if (message.destinationName == '$SYS/broker/clients/connected') {
	stUSERS.innerHTML = message.payloadString;
    if (message.payloadString < '3') {
	if (m12 == '1') {esp12(1);} else {esp12(0);}
	if (m01 == '1') {esp01(1);} else {esp01(0);}
	}
	}

	//клиентов на сервере
    //if (message.destinationName == '$SYS/broker/clients/inactive') {
	//if (message.payloadString == '0') {stUSERS.innerHTML = '1';}
	//else {stUSERS.innerHTML = message.payloadString;}}

    //уровень сигнала ESP01
	if (message.destinationName == 'ESP12/RSSI2') {stRSSI2.innerHTML = message.payloadString; }
	//уровень сигнала ESP12
	if (message.destinationName == 'ESP12/RSSI') {stRSSI.innerHTML = message.payloadString; }
	//уровень освещенности
	if (message.destinationName == 'ESP12/LDR') {stLDR.innerHTML = message.payloadString; }
	//температура на улице
	if (message.destinationName == 'ESP12/T2') {stT2.innerHTML = message.payloadString; temp2 = message.payloadString;}
	//температура в комнате
	if (message.destinationName == 'ESP12/T') {stT.innerHTML = message.payloadString; temp = message.payloadString;}
	//влажность в комнате
	if (message.destinationName == 'ESP12/H') {stH.innerHTML = message.payloadString; }
	//напряжение в сети
	if (message.destinationName == 'ESP12/V') {stPZEM.innerHTML = message.payloadString; }
	//датчик движения
	if (message.destinationName == 'ESP12/PIR') {stPIR.innerHTML = message.payloadString;}
	//статус светодиода
	if (message.destinationName == 'ESP12/LED') {
	//stLED.innerHTML = message.payloadString; 
	if (message.payloadString == '0') {id_LED.checked = false;}
	else {id_LED.checked = true;}
	if (flag == '') {flag = message.payloadString; }
	if (message.payloadString != flag) { flag = message.payloadString;}
	else {flag = message.payloadString; }}

	//мессенджер
	if (message.destinationName == 'ESP12/MESS') {
   	rmess.value += new Date().toLocaleTimeString() + ': ' + message.payloadString + '\r\n';
      	rmess.scrollTop = rmess.scrollHeight; 
        var txtUSER = message.payloadString;
	id_MESS.checked = true; id_area2.style.display='block';
        txtUSER = txtUSER.substring(0,txtUSER.indexOf('\r'));
	if (id_UTT.checked && txtUSER != user) { 
	  txtUSER = message.payloadString;
      txtUSER = txtUSER.substring(txtUSER.indexOf('\n'),txtUSER.length);
	  recognizer.stop();
	  flagSTOP = 1;
	  setTimeout(function(){speak(txtUSER);}, 2000);} 
	}
}

//=============================================================================
if ('webkitSpeechRecognition' in window) {
  var recognizer = new webkitSpeechRecognition();
  // Ставим опцию, чтобы распознавание началось ещё до того, как пользователь закончит говорить
  recognizer.interimResults = true;
  recognizer.lang = 'ru-Ru';
  //recognizer.continuous = true;
  //recognizer.maxAlternatives = 1;
}
  var voices = speechSynthesis.getVoices();
  var utterance = new SpeechSynthesisUtterance();
  utterance.voice = voices[1];

//=============================================================================
//Используем колбек для обработки результатов
recognizer.onresult = function (event) {
    var result = event.results[event.resultIndex];
    if (result.isFinal) {
      rec_str = result[0].transcript;
      if (id_REC.checked) {
        cntREC += 1;
	if (cntREC > 5) {cntREC = 0; rcmd.value='';}
        rcmd.value += new Date().toLocaleTimeString() + ': ' + result[0].transcript + '\r\n';
        rcmd.scrollTop = rcmd.scrollHeight;}
        //console.log(event);
    } else {
      console.log('Промежуточный результат: ', result[0].transcript);
    }
}

//=============================================================================
recognizer.onstart = function() {
  rec_flag = true;
}

//=============================================================================
recognizer.onend = function() {
rec_flag = false;
if (flagSTOP == 0) {
if (id_REC.checked) {
  var tmp;
  if (rec_str === 'включить'){sendLED('1');}
  if (rec_str === 'выключить'){sendLED('0');}
  tmp = temp.replace('.',' и ');
  //tmp = temp.substring(0,temp.indexOf('.'));
  //tmp = tmp + ' °';
  if (rec_str === 'температура') {speak(tmp);}
  rec_str = '';
}

if (id_RMESS.checked) {
  if (rec_str != '') {
    message = new Paho.MQTT.Message(user + '\r\n' + rec_str + '\r\n');
    message.destinationName = 'ESP12/MESS';
    client.send(message);} 
    rec_str = '';	
}

if (id_REC.checked || id_RMESS.checked) { recognizer.start();} 
}
}

//=============================================================================
utterance.onend = function() { 
  flagSTOP = 0;
  if (id_REC.checked || id_RMESS.checked) { recognizer.start();}
}

//=============================================================================
function speak(str){ 
  if (speechSynthesis.speaking) return; 
  utterance.text = str;
  speechSynthesis.speak(utterance);   //воспроизведение фразы
}

//=============================================================================
function checkBX(){
  if (id_REC.checked) {
  id_area1.style.display='block';
  localStorage.setItem('reccmd', id_REC.checked); } 
  else {
  id_area1.style.display='none';
  rcmd.value = '';	
  localStorage.setItem('reccmd', ''); }
  
  if (id_MESS.checked) {
  id_area2.style.display='block'; 
  localStorage.setItem('mess', id_MESS.checked); }
  else {
  id_RMESS.checked = false;
  id_UTT.checked = false;
  id_area2.style.display='none';
  localStorage.setItem('mess', ''); }

if ('webkitSpeechRecognition' in window) {
  if (id_REC.checked || id_RMESS.checked) {
  if (! rec_flag) {recognizer.start();} else { recognizer.stop();}}
}
}

//=============================================================================
function checkLED(){
  if (id_LED.checked) {sendLED('1');} 
  else {sendLED('0');}
}

//=============================================================================
function num() {
var AvaiableSymbol = '0123456789';
SearchChar=String.fromCharCode(window.event.keyCode);
if(AvaiableSymbol.indexOf(SearchChar.toUpperCase())<0)return false;
}

//=============================================================================
function btnConnect(){
  host = mq_serv.value; 
  port = parseInt(mq_port.value);
  user = mq_user.value; 
  login = mq_login.value;
  pass = mq_pass.value;

if (host=='' || mq_port.value=='' || user=='' || login=='' || pass=='') 
  {id_login.style.display='block'; alert('Ошибка\r\nЗаполните все поля формы'); return;}

if (id_SAVE.checked) {
  localStorage.setItem('serv', mq_serv.value);
  localStorage.setItem('port', mq_port.value);
  localStorage.setItem('user', mq_user.value);
  localStorage.setItem('login', mq_login.value);
  localStorage.setItem('pass', mq_pass.value);
  localStorage.setItem('save', id_SAVE.checked);}
  else {
  localStorage.setItem('pass', '');
  localStorage.setItem('save', '');
  localStorage.setItem('reccmd', '');
  localStorage.setItem('mess', '');
}
  MQTTconnect();
}

//=============================================================================
function btnSendMESS(){
    message = new Paho.MQTT.Message(user + '\r\n' + mq_mess.value + '\r\n');
    message.destinationName = 'ESP12/MESS';
    client.send(message);
    mq_mess.value = '';
}

//=============================================================================
function loadPAGE() {
if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
  //alert('код для мобильных устройств');
  document.body.style.backgroundColor = '#cfd8dc';
  lay1.style.border = '0'; 
  lay1.style.margin = '0';
  lay1.style.width = '100%';
  lay1.style.boxShadow = 'none'; 
  lay1.style.MozBoxShadow = 'none';
  lay1.style.webkitBoxShadow = 'none';
} else {
  //alert('код для обычных устройств');
}

  host = localStorage.getItem('serv');
  port = localStorage.getItem('port');
  user = localStorage.getItem('user');
  login = localStorage.getItem('login');
  pass = localStorage.getItem('pass');
  mq_serv.value = host;
  mq_port.value = port;
  mq_user.value = user;
  mq_login.value = login;
  mq_pass.value = pass;
  id_SAVE.checked = localStorage.getItem('save');
  if (id_SAVE.checked) {id_conn.style.display='blok'; btnConnect();}
  else {id_login.style.display='block'; id_conn.style.display='none';}
  stUSER1.innerHTML = user; 
}

//=============================================================================
function divEX(){
if (confirm("Вы действительно хотите выйти?")) {
  localStorage.clear();
  location.reload();
}
}

</script>
</body>
</html>