<!DOCTYPE html><html lang='ru'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=384'>
<title>MQTT Websocket</title>

<style>
body{margin:0; position:relative; background-color: #9ea7aa;}
::selection {background: #a0bbbb;}
::-moz-selection {background: #a0bbbb;}
input, textarea, button {outline: none;}

.icoH{background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDM4My4zNDQgMzgzLjM0NSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzgzLjM0NCAzODMuMzQ1OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI3My4yMTcsMTA2Ljg5OWMtMjcuMTgxLTQ0Ljg2NC01Ny40MTMtODMuNjkzLTczLjAxNi0xMDIuODQ2Yy0yLjA4OC0yLjU2NS01LjIyMS00LjA1NC04LjUyOC00LjA1MyAgIGMtMy4zMDgsMC02LjQ0LDEuNDg5LTguNTI5LDQuMDU0Yy0xNS42MDIsMTkuMTU5LTQ1LjgzNCw1OC4wMDEtNzMuMDE1LDEwMi44NjljLTM1LjAyOCw1Ny44MjMtNTIuNzg5LDEwNS42My01Mi43ODksMTQyLjA5ICAgYzAsNzQuMDcxLDYwLjI2MSwxMzQuMzMyLDEzNC4zMzIsMTM0LjMzMnMxMzQuMzMyLTYwLjI2MSwxMzQuMzMyLTEzNC4zMzJDMzI2LjAwNSwyMTIuNTI5LDMwOC4yNDYsMTY0LjcxNSwyNzMuMjE3LDEwNi44OTl6ICAgIE0yMTAuMTA2LDMzMy44NjhjLTcuODQ0LDIuMDA2LTE1Ljk4NiwzLjAyMi0yNC4yMDUsMy4wMjJjLTUwLjE4NiwwLTkxLjAxNS0zNy45MjktOTEuMDE1LTg0LjU1ICAgYzAtMTEuMjU1LDIuOTctMjQuNDA1LDguODI1LTM5LjA4M2MwLjk4OS0yLjQ4LDMuODA3LTMuODk1LDYuNTg1LTMuMjk1YzIuNzc2LDAuNTk4LDQuNjQsMy4wMTgsNC4zNTQsNS42NSAgIGMtMC4zNDIsMy4xNDgtMC41MTYsNi4yMjMtMC41MTYsOS4xMzZjMCw1MC43MzUsNDAuODgxLDkzLjIyMSw5NS4wOTMsOTguODIxYzIuNjk4LDAuMjc5LDQuODAzLDIuMjk3LDUuMDE4LDQuODEyICAgQzIxNC40NjEsMzMwLjg5NiwyMTIuNzIzLDMzMy4xOTgsMjEwLjEwNiwzMzMuODY4eiIgZmlsbD0iIzQ1NWE2NCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=);}

.icoT{background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ2NC42MDEgNDY0LjYwMSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDY0LjYwMSA0NjQuNjAxOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCI+CjxwYXRoIGQ9Ik0zMTMuNDgsMjc2LjU2OFY4MS4xNzJDMzEzLjQ4LDM2LjQxMSwyNzcuMDY5LDAsMjMyLjMwOCwwYy00NC43NiwwLTgxLjE4OCwzNi40MTEtODEuMTg4LDgxLjE3MnYxOTUuMzggIGMtMTkuNDA4LDIwLjYwNC0zMC40MjIsNDguMDUzLTMwLjQzNyw3Ni40MjVjMC4wMTUsNjEuNTM2LDUwLjA4OSwxMTEuNjA4LDExMS42MjQsMTExLjYyNCAgYzYxLjUyMS0wLjAxNiwxMTEuNTk0LTUwLjA4OCwxMTEuNjA4LTExMS42NDFDMzQzLjkwMiwzMjQuNjIxLDMzMi44ODgsMjk3LjE4OCwzMTMuNDgsMjc2LjU2OHogTTE1My43NTMsMzUyLjk5MSAgYzAuMDE1LTIyLjAwOCw4Ljk0NS00Mi40MTgsMjUuMTQxLTU3LjQzNWMzLjM3NS0zLjEzNCw1LjI5Ni03LjUyNSw1LjI5Ni0xMi4xMjZWODEuMTcyYzAtMjYuNTMsMjEuNTg4LTQ4LjEwMiw0OC4xMTgtNDguMTAyICBjMjYuNTI5LDAsNDguMTAzLDIxLjU3Miw0OC4xMDMsNDguMTAydjY2LjI2OGgtNTkuNTE5djEzNS45OTFjLTE4LjY4MywxNy4zNDEtMzAuNDIsNDIuMDQ3LTMwLjQzNyw2OS41NjEgIGMwLjAxNywzMi42NjYsMTYuNTUyLDYxLjQyNSw0MS42NzUsNzguNTI1QzE4OC45MDQsNDMxLjM4NiwxNTMuNzY4LDM5Ni4yMDIsMTUzLjc1MywzNTIuOTkxeiIgZmlsbD0iIzQ1NWE2NCIvPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K);}

.icoSign {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDIyNC43MiAyMjQuNzIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDIyNC43MiAyMjQuNzI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8cGF0aCBkPSJNMTQyLjcxOSwxNzMuMDExYzAsMTYuNzY0LTEzLjU2NywzMC4zMjctMzAuMzMxLDMwLjMyN2MtMTYuNzQ2LDAtMzAuMzIyLTEzLjU2My0zMC4zMjItMzAuMzI3ICAgYzAtMTYuNzYsMTMuNTc3LTMwLjMyNywzMC4zMjItMzAuMzI3QzEyOS4xNTEsMTQyLjY4NCwxNDIuNzE5LDE1Ni4yNTEsMTQyLjcxOSwxNzMuMDExeiBNNDIuNjA0LDExNC42NGwyMy4yNDQsMTkuNDg1ICAgYzIzLjE5LTI3LjY4OCw2OS45NjQtMjcuNjg4LDkzLjEyNywwLjAzMmwyMy4yNzktMTkuNDI5Yy0xNy4zODUtMjAuNzktNDIuODQ0LTMyLjY5My02OS44NjEtMzIuNjkzICAgQzg1LjM4Miw4Mi4wMzUsNTkuOTQxLDkzLjkxMSw0Mi42MDQsMTE0LjY0eiBNMCw3MS4xOThsMjIuNDc5LDIwLjM3NGMyMi45NTEtMjUuMzUyLDU1LjcyMy0zOS44NjQsODkuOTA5LTM5Ljg2NCAgIGMzNC4xNzcsMCw2Ni45MzEsMTQuNTEyLDg5Ljg4MywzOS44MDNsMjIuNDQ5LTIwLjM3NGMtMjguNjk4LTMxLjYyOS02OS42MjMtNDkuNzU2LTExMi4zMjctNDkuNzU2ICAgQzY5LjY1NiwyMS4zODIsMjguNjk4LDM5LjU2OSwwLDcxLjE5OHoiIGZpbGw9IiM0NTVhNjQiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)}

.icoFoto {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDQ1LjE2IDQ1LjE2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NS4xNiA0NS4xNjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxnPgoJCTxwYXRoIGQ9Ik0yMi41OCwxMS4yNjljLTYuMjM3LDAtMTEuMzExLDUuMDc1LTExLjMxMSwxMS4zMTJzNS4wNzQsMTEuMzEyLDExLjMxMSwxMS4zMTJjNi4yMzYsMCwxMS4zMTEtNS4wNzQsMTEuMzExLTExLjMxMiAgICBTMjguODE2LDExLjI2OSwyMi41OCwxMS4yNjl6IiBmaWxsPSIjNDU1YTY0Ii8+CgkJPGc+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTIyLjU4LDcuOTQ0Yy0xLjIxOSwwLTIuMjA3LTAuOTg4LTIuMjA3LTIuMjA2VjIuMjA3QzIwLjM3MywwLjk4OCwyMS4zNjEsMCwyMi41OCwwYzEuMjE5LDAsMi4yMDcsMC45ODgsMi4yMDcsMi4yMDcgICAgICB2My41MzFDMjQuNzg3LDYuOTU2LDIzLjc5OCw3Ljk0NCwyMi41OCw3Ljk0NHoiIGZpbGw9IiM0NTVhNjQiLz4KCQkJPC9nPgoJCQk8Zz4KCQkJCTxwYXRoIGQ9Ik0yMi41OCwzNy4yMTVjLTEuMjE5LDAtMi4yMDcsMC45ODgtMi4yMDcsMi4yMDd2My41M2MwLDEuMjIsMC45ODgsMi4yMDgsMi4yMDcsMi4yMDhjMS4yMTksMCwyLjIwNy0wLjk4OCwyLjIwNy0yLjIwOCAgICAgIHYtMy41M0MyNC43ODcsMzguMjAzLDIzLjc5OCwzNy4yMTUsMjIuNTgsMzcuMjE1eiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTMyLjkyOCwxMi4yMzFjLTAuODYxLTAuODYyLTAuODYxLTIuMjU5LDAtMy4xMjFsMi40OTctMi40OTdjMC44NjEtMC44NjEsMi4yNTktMC44NjEsMy4xMjEsMCAgICAgIGMwLjg2MiwwLjg2MiwwLjg2MiwyLjI2LDAsMy4xMjFsLTIuNDk3LDIuNDk3QzM1LjE4OCwxMy4wOTMsMzMuNzkxLDEzLjA5MywzMi45MjgsMTIuMjMxeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTEyLjIzMSwzMi45M2MtMC44NjItMC44NjMtMi4yNTktMC44NjMtMy4xMjEsMGwtMi40OTcsMi40OTZjLTAuODYxLDAuODYxLTAuODYyLDIuMjYsMCwzLjEyMSAgICAgIGMwLjg2MiwwLjg2MSwyLjI2LDAuODYxLDMuMTIxLDBsMi40OTctMi40OThDMTMuMDkzLDM1LjE4OCwxMy4wOTMsMzMuNzksMTIuMjMxLDMyLjkzeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTM3LjIxNSwyMi41OGMwLTEuMjE5LDAuOTg4LTIuMjA3LDIuMjA3LTIuMjA3aDMuNTMxYzEuMjE5LDAsMi4yMDcsMC45ODgsMi4yMDcsMi4yMDdjMCwxLjIxOS0wLjk4OCwyLjIwNi0yLjIwNywyLjIwNiAgICAgIGgtMy41MzFDMzguMjAzLDI0Ljc4NiwzNy4yMTUsMjMuNzk5LDM3LjIxNSwyMi41OHoiIGZpbGw9IiM0NTVhNjQiLz4KCQkJPC9nPgoJCQk8Zz4KCQkJCTxwYXRoIGQ9Ik03Ljk0NCwyMi41OGMwLTEuMjE5LTAuOTg4LTIuMjA3LTIuMjA3LTIuMjA3aC0zLjUzQzAuOTg4LDIwLjM3MywwLDIxLjM2MSwwLDIyLjU4YzAsMS4yMTksMC45ODgsMi4yMDYsMi4yMDcsMi4yMDYgICAgICBoMy41MzFDNi45NTYsMjQuNzg2LDcuOTQ0LDIzLjc5OSw3Ljk0NCwyMi41OHoiIGZpbGw9IiM0NTVhNjQiLz4KCQkJPC9nPgoJCQk8Zz4KCQkJCTxwYXRoIGQ9Ik0zMi45MjgsMzIuOTNjMC44NjItMC44NjEsMi4yNi0wLjg2MSwzLjEyMSwwbDIuNDk3LDIuNDk3YzAuODYyLDAuODYsMC44NjIsMi4yNTksMCwzLjEycy0yLjI1OSwwLjg2MS0zLjEyMSwwICAgICAgbC0yLjQ5Ny0yLjQ5N0MzMi4wNjYsMzUuMTg4LDMyLjA2NiwzMy43OTEsMzIuOTI4LDMyLjkzeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8L2c+CgkJCTxnPgoJCQkJPHBhdGggZD0iTTEyLjIzMSwxMi4yMzFjMC44NjItMC44NjIsMC44NjItMi4yNTksMC0zLjEyMUw5LjczNCw2LjYxNGMtMC44NjItMC44NjItMi4yNTktMC44NjItMy4xMjEsMCAgICAgIGMtMC44NjIsMC44NjEtMC44NjIsMi4yNTksMCwzLjEybDIuNDk3LDIuNDk3QzkuOTcyLDEzLjA5NCwxMS4zNjksMTMuMDk0LDEyLjIzMSwxMi4yMzF6IiBmaWxsPSIjNDU1YTY0Ii8+CgkJCTwvZz4KCQk8L2c+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)}

.icoV {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCI+CjxnPgoJPGc+CgkJPHBhdGggZD0iTTQwMC4yNjgsMTc1LjU5OWMtMS4zOTktMy4wMDQtNC40MTItNC45MzItNy43MzEtNC45MzJoLTEwMS4xMmw5OS43OTctMTU3LjU2OGMxLjY2NC0yLjYyOCwxLjc2Ni01Ljk1NiwwLjI2NS04LjY3OCAgICBDMzg5Ljk3NywxLjY5LDM4Ny4xMDksMCwzODQuMDAzLDBIMjQ3LjQ3Yy0zLjIzNCwwLTYuMTg3LDEuODI2LTcuNjM3LDQuNzE5bC0xMjgsMjU2Yy0xLjMyMywyLjYzNy0xLjE3OCw1Ljc3NywwLjM3NSw4LjI5NCAgICBjMS41NjIsMi41MTcsNC4zMDEsNC4wNTMsNy4yNjIsNC4wNTNoODcuNzQ4bC05NS42MTYsMjI3LjA4OWMtMS42MywzLjg4My0wLjE3OSw4LjM4OCwzLjQxMywxMC41OSAgICBjMS4zODIsMC44NDUsMi45MTgsMS4yNTQsNC40NDYsMS4yNTRjMi40NDksMCw0Ljg2NC0xLjA1LDYuNTM3LTMuMDI5bDI3My4wNjctMzI0LjI2NyAgICBDNDAxLjIwNiwxODIuMTYxLDQwMS42NjcsMTc4LjYxMSw0MDAuMjY4LDE3NS41OTl6IiBmaWxsPSIjNDU1YTY0Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)}

.icoPIR {background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4Ij4KPGc+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZD0iTTE3MC42NjcsMjg1djEzNC4wMWMxMC4zNTQsMi43ODEsMzUuNTgzLDcuNjU2LDg1LjM1NCw3LjY1NmM0OS42NjcsMCw3NC44NzUtNC44NTQsODUuMzEzLTcuNjY3VjI4NC45OSAgICAgYy0xMC4zNDQtMi43ODEtMzUuNTYzLTcuNjU2LTg1LjMzMy03LjY1NkMyMDYuMzIzLDI3Ny4zMzMsMTgxLjExNSwyODIuMTg4LDE3MC42NjcsMjg1eiIgZmlsbD0iIzQ1NWE2NCIvPgoJCQk8cGF0aCBkPSJNNDM3LjMzMywwSDc0LjY2N0M2OC43NzEsMCw2NCw0Ljc3MSw2NCwxMC42Njd2NDIuNjY3QzY0LDU5LjIyOSw2OC43NzEsNjQsNzQuNjY3LDY0SDIyNHY0My41MSAgICAgYy02Ni40NjEsMy42NzgtOTMuMjM4LDE4LjczOC0xMTMuNDY5LDMwLjEyNWwtMy44MzMsMi4xNTZjLTEzLjE3Nyw3LjMxMy0yMS4zNjUsMjEuNDktMjEuMzY1LDM2Ljk3OXYyNjUuMTI1ICAgICBjMCwxNS40OSw4LjE4OCwyOS42NjcsMjEuMzY1LDM2Ljk3OWwzLjgzMywyLjE1NkMxMzMuNzQsNDk0LjA5NCwxNjUuNTIxLDUxMiwyNTYsNTEyczEyMi4yNi0xNy45MDYsMTQ1LjQ2OS0zMC45NjlsMy44MzMtMi4xNTYgICAgIGMxMy4xNzctNy4zMTMsMjEuMzY1LTIxLjQ5LDIxLjM2NS0zNi45NzlWMTc2Ljc3MWMwLTE1LjQ5LTguMTg4LTI5LjY2Ny0yMS4zNjUtMzYuOTc5bC0zLjgzMy0yLjE1NiAgICAgYy0yMC4yMy0xMS4zODctNDcuMDA4LTI2LjQ0Ny0xMTMuNDY5LTMwLjEyNVY2NGgxNDkuMzMzQzQ0My4yMjksNjQsNDQ4LDU5LjIyOSw0NDgsNTMuMzMzVjEwLjY2N0M0NDgsNC43NzEsNDQzLjIyOSwwLDQzNy4zMzMsMCAgICAgeiBNMjU2LDE3MC42NjdjMTEuNzYsMCwyMS4zMzMsOS41NzMsMjEuMzMzLDIxLjMzM1MyNjcuNzYsMjEzLjMzMywyNTYsMjEzLjMzM1MyMzQuNjY3LDIwMy43NiwyMzQuNjY3LDE5MiAgICAgUzI0NC4yNCwxNzAuNjY3LDI1NiwxNzAuNjY3eiBNMzU2Ljc3MSwyNjcuNzkyYzMuNjE1LDEuODEzLDUuODk2LDUuNSw1Ljg5Niw5LjU0MnYxNDkuMzMzYzAsNC4wNDItMi4yODEsNy43MjktNS44OTYsOS41NDIgICAgIEMzNTQuMzY1LDQzNy40MTcsMzMxLjA0Miw0NDgsMjU2LjAyMSw0NDhzLTk4LjM3NS0xMC41ODMtMTAwLjc5Mi0xMS43OTJjLTMuNjE1LTEuODAyLTUuODk2LTUuNS01Ljg5Ni05LjU0MlYyNzcuMzMzICAgICBjMC00LjA0MiwyLjI4MS03LjcyOSw1Ljg5Ni05LjU0MkMxNTcuNjQ2LDI2Ni41ODMsMTgwLjk3OSwyNTYsMjU2LDI1NlMzNTQuMzU0LDI2Ni41ODMsMzU2Ljc3MSwyNjcuNzkyeiIgZmlsbD0iIzQ1NWE2NCIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)}

.icoT, .icoH, .icoSign, .icoFoto, .icoV, .icoPIR {float: left; width: 32px; height: 32px; margin: -3px 10px 0 0;}

#lay1 {width: 354px; padding: 0; margin: 12px auto; border: 1px solid gray; border-radius: 4px;
box-shadow: 0 0 10px rgba(0,0,0,0.3); -moz-box-shadow: 0 0 10px rgba(0,0,0,0.3); -webkit-box-shadow: 0 0 10px rgba(0,0,0,0.3);
background: rgba(207,216,220,1); /* Цвет фона и значение прозрачности */
color: #455a64; font-family: Helvetica; font-size: 18px;}

.lay2 {width: 40px; float: right;}
.lay3 {width: 32px; float: right;}
.ram0 {width: 354px; margin: 0; overflow: hidden; padding: 14px 12px 0 12px; font-family: Helvetica; font-size: 15px;}

h1 {font-size: 30px; margin: -4px 0 0 0; }
h3 {width: 354px; margin: 0 4px 12px 0;}
h1, h3 {font-weight:normal;}

.lab1 {width: 50%; float: left;  margin: 0 0 12px 0;}
.lab2 {width: 100%; float: left;  margin: 0 0 12px 0;}
.block1 { border: solid 1px #2F4F4F; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);}

.ex1 {position: relative; width: 30px; height: 30px; background-color: white; border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);}
.ex1::before, .ex1::after { position: absolute;	top: 14px; left: 8px; width: 14px; height: 3px;	content: '';
    background-color: #2F4F4F;}
.ex1::before {-ms-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); transform: rotate(-45deg);}
.ex1::after {-ms-transform: rotate(45deg); -webkit-transform: rotate(45deg);	transform: rotate(45deg);}
.ex1:active::before, .ex1:active::after { background-color: white; }
.ex1:active {background-color: #2F4F4F;}

input[type='checkbox'] { display: none;}
input[type='checkbox']:checked ~ .toggle { background: #4169e1; left: 15px; transition: .2s;}
input[type='checkbox']:checked ~ .switch { background: #93AEFF; transition: .2s;}
.switch {display: block; width: 32px; height: 14px; background: #939393; border-radius: 10px;
  position: absolute; top: 0; transition: .2s;}
.toggle {height: 21px; width: 21px; border-radius: 50%; background: white; position: absolute;
  top: -4px; left: -4px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); transition: .2s;}
.card {display: inline-block; margin: 0 4px 0 4px; width: 25px; height: 13px; text-align: center; position: relative;}

.btn {width: 100%; height: 40px; margin: 0; color: #455a64; font-family: Helvetica; font-size: 18px;
 background: linear-gradient(#F7F7F7, #DCDCDC); border: 1px solid #949494; border-radius: 2px; outline: none;}
.btn:active {background: linear-gradient(#DCDCDC, #F7F7F7);}
.btn:hover {border: 1px solid #6E6E6E;}

.ed {outline: none; resize: none;}
.ed2 {height: 24px;}
.ed,.ed2 {width: 340px; color: #455a64; font-family: Helvetica; font-size: 18px; 
border: 1px solid gray; border-radius: 4px; padding: 6px; box-shadow: 0 3px 4px rgba(0,0,0,0.1) inset;}

.ver {font-size: 14px; margin: 12px 0 12px 0;}

</style>
</head> 

<body onload='loadPAGE()'>
<table id='lay1'>
<tr><td>
<div class='ram0'>
  <h1>MQTT Websocket 
  <div class='lay3' id='id_EX' style='display: none'><div class='ex1' title='Выход' onclick="divEX()"></div></div>
  </h1></h1>
  <hr>
<div id='id_conn'><h3>Подключение...</h3></div>
<div id='id_login' style="display: none">
<form>
  <h3>Авторизация</h3>
  <p><input class='ed2' id='mq_serv' type='text' placeholder='Сервер'></p>			
  <p><input class='ed2' id='mq_port' type='text' placeholder='Порт' onkeypress="return num()"></p>
  <p><input class='ed2' id='mq_user' type='text' placeholder='Пользователь'></p>
  <p><input class='ed2' id='mq_login' type='text' placeholder='Логин'></p>			
  <p><input class='ed2' id='mq_pass' type='password' placeholder='Пароль'></p>
  <h3><label>Запомнить меня <div class='lay2'>
    <div class='card'><label for='id_SAVE'>
    <input type='checkbox' id='id_SAVE'/><span class='switch'></span><span class="toggle"></span>
    </label></div></div>
  </label></h3>	  
  <p><input class='btn' type='button' value='Войти' onClick="btnConnect()"/></p>
</form>
</div>
<div id='id_mqtt' style='display: none'>
  <h3>Статус сервера: <a id='stMQTT'></a></h3>
  <h3>Клиентов на сервере: <a id='stUSERS'></a></h3>
  <h3>Последнее обновление: <a id='time'></a></h3>
  <h3>Модуль ESP01: <a id='stESP01'></a></h3>
  <h3>Модуль ESP12: <a id='stESP12'></a></h3>
<div id='id_m1' style='display: none'>
  <div class='lab1' title='ESP01'><h3>Уровень сигнала</h3><div class='icoSign'></div><h1><a id='stRSSI2'></a> dBm</h1></div>
  <div class='lab1' title='На улице'><h3>Температура</h3><div class='icoT'></div><h1><a id='stT2'></a> &degC</h1></div>
</div>
<div id='id_m2' style='display: none'>
  <div class='lab1' title='ESP12'><h3>Уровень сигнала</h3><div class='icoSign'></div><h1><a id='stRSSI'></a> dBm</h1></div>
  <div class='lab1' title='В комнате'><h3>Освещенность</h3><div class='icoFoto'></div><h1><a id='stLDR'></a></h1></div>
  <div class='lab1' title='В комнате'><h3>Влажность</h3><div class='icoH'></div><h1><a id='stH'></a> %</h1></div>
  <div class='lab1' title='В комнате'><h3>Температура</h3><div class='icoT'></div><h1><a id='stT'></a> &degC</h1></div>
  <div class='lab1' title='PZEM-004'><h3>Напряжение в сети</h3><div class='icoV'></div><h1><a id='stPZEM'></a> V</h1></div>
  <div class='lab1' title='HC-SR501'><h3>Датчик движения</h3><div class='icoPIR'></div><h1><a id='stPIR'></a></h1></div>
  <h3><label title='Не оставляйте светодиод включенным'>Управление светодиодом ESP12<div class='lay2'>
    <div class='card'><label for='id_LED'>
    <input type='checkbox' id='id_LED' onclick="checkLED()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>

  <h3><label title='Работает только в Google Chrome'>Голосовое управление <div class='lay2'>
    <div class='card'><label for='id_REC'>
    <input type='checkbox' id='id_REC' onclick="checkBX()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
<div id='id_area1' style="display: none">
  <h3>Команды: включить, выключить, температура</h3>
  <textarea readonly class='ed' id='rcmd' rows='6'></textarea>
  <div class='lab2'></div>
</div>
</div>
<h3><label>MQTT Messenger <div class='lay2'>
    <div class='card'><label for='id_MESS'>
    <input type='checkbox' id='id_MESS' onclick="checkBX()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
<div id='id_area2' style="display: none">
   <h3>Пользователь: <a id='stUSER1'></a></h3>
   <textarea readonly class='ed' id='rmess' rows='8'></textarea>
<form onsubmit="btnSendMESS(); return false">
   <p><input class='ed2' id='mq_mess' autocomplete='off' type='text' placeholder='Сообщение'>
</p>
</form>
<h3><label title='Работает только в Google Chrome'>Голосовой набор сообщения<div class='lay2'>
    <div class='card'><label for='id_RMESS'>
    <input type='checkbox' id='id_RMESS' onclick="checkBX()"/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
  <h3><label>Голосовой ответ<div class='lay2'>
    <div class='card'><label for='id_UTT'>
    <input type='checkbox' id='id_UTT'/><span class='switch'></span><span class='toggle'></span>
    </label></div></div>
  </label></h3>
</div>

</div>
<p class='ver'>Версия: 20180624-1314</p>
</div>
</td></tr>
</table>


<script src="mqttws31.js" type="text/javascript"></script>
<script type="text/javascript">
//=============================================================================
//глобальные переменные
var idUSER = ''; flag = ''; temp = ''; host = ''; port = 0; user = ''; US = '1'; cntREC = 0;
var login = ''; pass = ''; txtUTT = ''; flagSTOP = 0; rec_str = ''; rec_flag = ''; m01 = 0; m12 = 0;

//stT.innerHTML = '00.0';
//stH.innerHTML = '00.0';
//stT2.innerHTML = '00.0';
//stRSSI.innerHTML = '-00';
//stRSSI2.innerHTML = '-00';
//stPZEM.innerHTML = '000.0';

function playSound() {
  if (typeof window.Audio === 'function') {
    var audioElem = new Audio();
    audioElem.src = "data:audio/ogg;base64,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";
    audioElem.play();
  }
}

//=============================================================================
function MQTTconnect() {
  // Create a client instance
  idUSER = parseInt(Math.random() * 100, 10);
  client = new Paho.MQTT.Client(host, port, 'web_' + idUSER);
  // set callback handlers
  client.onConnectionLost = onConnectionLost;
  client.onMessageArrived = onMessageArrived;

  // Connect the client, with a Last-Will-and-Testament
  //var lwt = new Paho.MQTT.Message('-');  
  //lwt.destinationName = 'ESP12/Users';

  var options = {
    useSSL: true,
    userName: login,
    password: pass,
    //willMessage: lwt,
    onSuccess: onConnect,
    onFailure: doFail,
  }
  // connect the client
  client.connect(options);
}

//=============================================================================
// called when the client connects
function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    console.log('onConnect');
    stMQTT.innerHTML='Подключен';
    id_conn.style.display='none';
    stESP01.innerHTML='Не подключен';
    stESP12.innerHTML='Не подключен';
    stUSERS.innerHTML = '1';
    client.subscribe('$SYS/broker/clients/connected');
    client.subscribe('ESP12/#');
    
    message = new Paho.MQTT.Message(' ');
    message.destinationName = 'ESP12/Status';
    client.send(message);

    id_login.style.display='none';
    id_mqtt.style.display='block';
    if (id_SAVE.checked) {
    id_EX.style.display='block';
    id_REC.checked = localStorage.getItem('reccmd'); 
    id_MESS.checked = localStorage.getItem('mess'); 
    checkBX(); }
}

//=============================================================================
function doFail(e){
    console.log(e);
    //stMQTT.innerHTML='Не подключен';
    id_login.style.display='block';
    id_conn.style.display='none';
    alert('Ошибка подключения к серверу\r\nПроверьте правильность введенных параметров и соединение с интернетом');
}

//=============================================================================
// called when the client loses its connection
function onConnectionLost(responseObject) {
    if (responseObject.errorCode !== 0) {
      console.log("onConnectionLost:"+responseObject.errorMessage);
      stMQTT.innerHTML=responseObject.errorMessage;
      //alert('Ошибка\r\n'+responseObject.errorMessage);
    }
}

//=============================================================================
function btnSH(topic, setsh) {
    message = new Paho.MQTT.Message(setsh);
    message.destinationName = topic;
    client.send(message);
}

//=============================================================================
function sendLED(ld) {
    message = new Paho.MQTT.Message(ld);
    message.destinationName = 'ESP12/SetLED';
    client.send(message);
}

//=============================================================================
function esp01(set) {
 if (set == 1) {stESP01.innerHTML = 'Подключен'; id_m1.style.display='block'; }
 else {stESP01.innerHTML = 'Не подключен'; id_m1.style.display='none'; }
}

//=============================================================================
function esp12(set) {
 if (set == 1) {stESP12.innerHTML = 'Подключен'; id_m2.style.display='block'; }
 else {stESP12.innerHTML = 'Не подключен'; id_m2.style.display='none'; }
}

//=============================================================================
// called when a message arrives
function onMessageArrived(message) {
	console.log(message.destinationName + ':' + message.payloadString);
	time.innerHTML = new Date().toLocaleTimeString();

	//статус модуля
	if (message.destinationName == 'ESP12/Status') {
    m12=0; m01=0;
	if (message.payloadString == '1') {m12=1; esp12(1);}
	if (message.payloadString == '2') {m01=1; esp01(1);}
	}

	//клиентов на сервере
    if (message.destinationName == '$SYS/broker/clients/connected') {
	stUSERS.innerHTML = message.payloadString;
    if (message.payloadString < '3') {
	if (m12 == '1') {esp12(1);} else {esp12(0);}
	if (m01 == '1') {esp01(1);} else {esp01(0);}
	}
	}

	//клиентов на сервере
    //if (message.destinationName == '$SYS/broker/clients/inactive') {
	//if (message.payloadString == '0') {stUSERS.innerHTML = '1';}
	//else {stUSERS.innerHTML = message.payloadString;}}

    //уровень сигнала ESP01
	if (message.destinationName == 'ESP12/RSSI2') {stRSSI2.innerHTML = message.payloadString; }
	//уровень сигнала ESP12
	if (message.destinationName == 'ESP12/RSSI') {stRSSI.innerHTML = message.payloadString; }
	//уровень освещенности
	if (message.destinationName == 'ESP12/LDR') {stLDR.innerHTML = message.payloadString; }
	//температура на улице
	if (message.destinationName == 'ESP12/T2') {stT2.innerHTML = message.payloadString; temp2 = message.payloadString;}
	//температура в комнате
	if (message.destinationName == 'ESP12/T') {stT.innerHTML = message.payloadString; temp = message.payloadString;}
	//влажность в комнате
	if (message.destinationName == 'ESP12/H') {stH.innerHTML = message.payloadString; }
	//напряжение в сети
	if (message.destinationName == 'ESP12/V') {stPZEM.innerHTML = message.payloadString; }
	//датчик движения
	if (message.destinationName == 'ESP12/PIR') {stPIR.innerHTML = message.payloadString; 
        //if (message.payloadString == '1') { playSound2();}
	}

	//статус светодиода
	if (message.destinationName == 'ESP12/LED') {
	//stLED.innerHTML = message.payloadString; 
	if (message.payloadString == '0') {id_LED.checked = false;}
	else {id_LED.checked = true;}
	if (flag == '') {flag = message.payloadString; }
	if (message.payloadString != flag) { flag = message.payloadString; playSound();}
	else {flag = message.payloadString; }}

	//мессенджер
	if (message.destinationName == 'ESP12/MESS') {
   	rmess.value += new Date().toLocaleTimeString() + ': ' + message.payloadString + '\r\n';
      	rmess.scrollTop = rmess.scrollHeight; 
        var txtUSER = message.payloadString;
	id_MESS.checked = true; id_area2.style.display='block';
        txtUSER = txtUSER.substring(0,txtUSER.indexOf('\r'));
	if (id_UTT.checked && txtUSER != user) { 
	  txtUSER = message.payloadString;
      txtUSER = txtUSER.substring(txtUSER.indexOf('\n'),txtUSER.length);
	  recognizer.stop();
	  flagSTOP = 1;
	  setTimeout(function(){speak(txtUSER);}, 2000);} 
	else { playSound();}  
	}
}

//=============================================================================
if ('webkitSpeechRecognition' in window) {
  var recognizer = new webkitSpeechRecognition();
  // Ставим опцию, чтобы распознавание началось ещё до того, как пользователь закончит говорить
  recognizer.interimResults = true;
  recognizer.lang = 'ru-Ru';
  //recognizer.continuous = true;
  //recognizer.maxAlternatives = 1;
}
  var voices = speechSynthesis.getVoices();
  var utterance = new SpeechSynthesisUtterance();
  utterance.voice = voices[1];

//=============================================================================
//Используем колбек для обработки результатов
recognizer.onresult = function (event) {
    var result = event.results[event.resultIndex];
    if (result.isFinal) {
      rec_str = result[0].transcript;
      if (id_REC.checked) {
        cntREC += 1;
	if (cntREC > 5) {cntREC = 0; rcmd.value='';}
        rcmd.value += new Date().toLocaleTimeString() + ': ' + result[0].transcript + '\r\n';
        rcmd.scrollTop = rcmd.scrollHeight;}
        //console.log(event);
    } else {
      console.log('Промежуточный результат: ', result[0].transcript);
    }
}

//=============================================================================
recognizer.onstart = function() {
  rec_flag = true;
}

//=============================================================================
recognizer.onend = function() {
rec_flag = false;
if (flagSTOP == 0) {
if (id_REC.checked) {
  var tmp;
  if (rec_str === 'включить'){sendLED('1');}
  if (rec_str === 'выключить'){sendLED('0');}
  tmp = temp.replace('.',' и ');
  //tmp = temp.substring(0,temp.indexOf('.'));
  //tmp = tmp + ' °';
  if (rec_str === 'температура') {speak(tmp);}
  rec_str = '';
}

if (id_RMESS.checked) {
  if (rec_str != '') {
    message = new Paho.MQTT.Message(user + '\r\n' + rec_str + '\r\n');
    message.destinationName = 'ESP12/MESS';
    client.send(message);} 
    rec_str = '';	
}

if (id_REC.checked || id_RMESS.checked) { recognizer.start();} 
}
}

//=============================================================================
utterance.onend = function() { 
  flagSTOP = 0;
  if (id_REC.checked || id_RMESS.checked) { recognizer.start();}
}

//=============================================================================
function speak(str){ 
  if (speechSynthesis.speaking) return; 
  utterance.text = str;
  speechSynthesis.speak(utterance);   //воспроизведение фразы
}

//=============================================================================
function checkBX(){
  if (id_REC.checked) {
  id_area1.style.display='block';
  localStorage.setItem('reccmd', id_REC.checked); } 
  else {
  id_area1.style.display='none';
  rcmd.value = '';	
  localStorage.setItem('reccmd', ''); }
  
  if (id_MESS.checked) {
  id_area2.style.display='block'; 
  localStorage.setItem('mess', id_MESS.checked); }
  else {
  id_RMESS.checked = false;
  id_UTT.checked = false;
  id_area2.style.display='none';
  localStorage.setItem('mess', ''); }

if ('webkitSpeechRecognition' in window) {
  if (id_REC.checked || id_RMESS.checked) {
  if (! rec_flag) {recognizer.start();} else { recognizer.stop();}}
}
}

//=============================================================================
function checkLED(){
  if (id_LED.checked) {sendLED('1');} 
  else {sendLED('0');}
}

//=============================================================================
function num() {
var AvaiableSymbol = '0123456789';
SearchChar=String.fromCharCode(window.event.keyCode);
if(AvaiableSymbol.indexOf(SearchChar.toUpperCase())<0)return false;
}

//=============================================================================
function btnConnect(){
  host = mq_serv.value; 
  port = parseInt(mq_port.value);
  user = mq_user.value; 
  login = mq_login.value;
  pass = mq_pass.value;

if (host=='' || mq_port.value=='' || user=='' || login=='' || pass=='') 
  {id_login.style.display='block'; alert('Ошибка\r\nЗаполните все поля формы'); return;}

if (id_SAVE.checked) {
  localStorage.setItem('serv', mq_serv.value);
  localStorage.setItem('port', mq_port.value);
  localStorage.setItem('user', mq_user.value);
  localStorage.setItem('login', mq_login.value);
  localStorage.setItem('pass', mq_pass.value);
  localStorage.setItem('save', id_SAVE.checked);}
  else {
  localStorage.setItem('pass', '');
  localStorage.setItem('save', '');
  localStorage.setItem('reccmd', '');
  localStorage.setItem('mess', '');
}
  MQTTconnect();
}

//=============================================================================
function btnSendMESS(){
    message = new Paho.MQTT.Message(user + '\r\n' + mq_mess.value + '\r\n');
    message.destinationName = 'ESP12/MESS';
    client.send(message);
    mq_mess.value = '';
}

//=============================================================================
function loadPAGE() {
if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
  //alert('код для мобильных устройств');
  document.body.style.backgroundColor = '#cfd8dc';
  lay1.style.border = '0'; 
  lay1.style.margin = '0';
  lay1.style.width = '100%';
  lay1.style.boxShadow = 'none'; 
  lay1.style.MozBoxShadow = 'none';
  lay1.style.webkitBoxShadow = 'none';
} else {
  //alert('код для обычных устройств');
}

  host = localStorage.getItem('serv');
  port = localStorage.getItem('port');
  user = localStorage.getItem('user');
  login = localStorage.getItem('login');
  pass = localStorage.getItem('pass');
  mq_serv.value = host;
  mq_port.value = port;
  mq_user.value = user;
  mq_login.value = login;
  mq_pass.value = pass;
  id_SAVE.checked = localStorage.getItem('save');
  if (id_SAVE.checked) {id_conn.style.display='blok'; btnConnect();}
  else {id_login.style.display='block'; id_conn.style.display='none';}
  stUSER1.innerHTML = user; 
}

//=============================================================================
function divEX(){
if (confirm("Вы действительно хотите выйти?")) {
  localStorage.clear();
  location.reload();
}
}

</script>
</body>
</html>